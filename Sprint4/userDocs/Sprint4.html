<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
    <!--
<link rel="stylesheet" type="text/css" href="../css/issStyle1.css">
<script type="text/javascript" src="../css/issStyle.js"></script>
-->
<style type="text/css">
body
{
    margin-left:  30px;
    margin-right: 30px;
};

P
{
    font-family: Tahoma;
    font-size: 10pt;
};

a, a:visited, a:active, a:link, a:hover {
    text-decoration: underline;
    color: #545454;
    background-color: transparent;
	font-size: 93%;
}

a:hover {
    background-color: #cccccc;
}


hr {
    clear: both;
    height: 1px;
    color: #242424;
    background-color: transparent;
}

h1, h2, h3 {
    color: #242424;
    clear: left;
    font: 100% Tahoma, Helvetica, Arial, sans-serif;
    margin-bottom: 0.5em;
    padding-top: 0.5em;
	border-radius: 10px;
	padding: 5px;
}

top {
	width: 100%;
}


#i {
    color: #ff1010;
}
tt{
	font-family: "Arial";
    font-size: 90%;
	color: #006600;
}
em{
	font-family: "Arial";
    font-size: 80%;
	font-weight: bold;
	border-style:solid;
	border-color: #abe876;
    color: #1632cc;
}
bc{
	font-family: "Arial";
	font-size: 90%;
	font-weight: bold;
    color: #990000;
	background-color: #fcf8c7;
}
ks{
	font-family: "Arial";
	font-weight: bold;
    color: #0000CD	;
	font-size: 90%;
}
kc{
	font-family: "Arial";
	font-weight: bold;
    color: #008000	;
	font-size: 90%;
}
kr{
	font-family: "Arial";
	font-weight: bold;
    color: #ff0000	;
	font-size: 90%;
}
pre{
	font-family: "Consolas";
	font-size: 85%;
	background-color: #f5f5f5;
	border: 1.5px solid silver;
	padding: 5px;
}
m{
	font-family: "Helvetica";
	line-height: 100%;
 	font-size: 75%;
}
div.body{

    font-size: 18px;
}
k{
    color: #990000;
	font-weight: bold;
	font-size: 90%;
}
h1 {
    font-size: 150%;
    background-color: #b2c0ff;
	padding: 10px;
}

h2 {
    background-color: #9ed8ff;
    font-size: 130%;
}

h3 {
	background-color: #e6ccff;
    font-size: 100%;
}
h4 {
    background-color: #ccffcc;
    font-size: 100%;
	width: 100%;
	border-radius: 5px;
	padding: 2px;
}
h5 {
    background-color: #d5ffb0;
    font-size: 100%;

}
div.req{
	background-color: #d9ffb3;
    font-size: 18px;
	width: 700px;
    border: 3px solid green;
    padding: 15px;
    margin: 10px;
}
div.remark{
	background-color: #E3F2FD;
    border: 1.5px solid #d5f2ed;
    padding: 15px;
    margin: 10px;
	border-radius: 25px;
}
table, th, td {
  border: 1px solid black;
  border-collapse: collapse;
}

#exampleclass tbody,
#exampleclass thead,
#exampleclass th {
  border: 0;
}

ol, ul, li {
  margin: 0;
  margin-left: 10px;
  padding: 0;
  padding-bottom: 5px;
}

table, th, td {
	border: 1px solid black;
}

img {
	border: 1.5px solid #d5f2ed

}

a, a:visited, a:active, a:link, a:hover {
    text-decoration: underline;
    color: #545454;
    background-color: transparent;
}

div.wrapdesc{
	width: 90%;
	margin: auto;
}

div.imagedesc{
	width: 85%;
	margin: auto;
}
</style>

<head>

<title>Final task ISS-2021 Bologna: Automated Car-Parking - Sprint 4</title></head>

<body>
<div id="top">
<h1>Final task ISS-2021 Bologna: Automated Car-Parking - Sprint 4<font size="5"></font> </h1>
</div>

<div class="body">
<div id = "backlog">
  <h2>Sprint 4 Backlog</h2>
  <div class="remark">
    Sprint 4 regards the develop of the <ks>PMS</ks> able to manage interaction with manager and care of system status:
    <ul>
      <li><ks>PMS</ks> satisfies manager's start and stop trolley and fan requests:
        <a href="../../requirements/userDocs/Automated Car-Parking.html#R4" target = "_blank">R4</a>,
        <a href="../../requirements/userDocs/Automated Car-Parking.html#R5" target = "_blank">R5</a>.
      <li><ks>PMS</ks> maintains an updated version of the system status:
        <a href="../../requirements/userDocs/Automated Car-Parking.html#R4" target = "_blank">R4</a>.</li>
      <li><ks>PMS</ks> recognizes critical OUTDOOR-area situation and generates an alarm for the manager:
          <a href="../../requirements/userDocs/Automated Car-Parking.html#R4" target = "_blank">R4</a>.</li>
    </ul>
  </div>
</div>
<h4>Starting point</h4>
<center><img src="IMG/StartingPoint.png" alt="starting_point_sprint" width="40%"></center>


<div id = "problem_analysis">
<h2>Problem analysis</h2>
<div class="remark">
  This Sprint aim is to develop and deeper describe the following entities:
  <ul>
    <li><ks>ParkServiceStatusGUI</ks> interacts directly with the manager;</li>
    <li><ks>Park Manager Service</ks> processes managers' requests;</li>
  </ul>
</div>
<div class = "remark">
  An initial model of these entities, without interaction between them, can be found <a href = "../src/model1_sprint3.qakt" target = "_blank">here</a>.<br>
</div>
  <h3>PMS</h3>
  <div class = "remark" id="problem_analysis_PMS">
    From the <a href="#backlog">backlog</a>, the <ks>PMS</ks> needs to process manager's requests and provide information about current system status. <br>
    As suggested in previous Sprint, the introduction of a new entity allows to process manager's tasks without affect the rest of the application. In particular, thanks 
    to the <a href="href=../../Sprint2/userDocs/Sprint3.html#parking_state" target = "_blank">Parking State</a> described in the last Sprint, this Sprint will focus on how
    to properly send that data to the manager GUI. Since the data represent the current system status, every change must be notified as soon as possibile (instantly non mi piaceva). <br>

    In addition, manager's task higly depends on park temperature and he should be properly notified when the temperatue exceeds <ks>TMAX</ks> threshold. Infact, the manager is able
    to start or stop the trolley and turn off the fan is temperature is below <ks>TMAX</ks> and turn on the fan otherwise. <br>

    In order to avoid chances of human errors, fan management (turn on/turn off) should be done automatically by interacting with <a href="Sprint2/src/adapters/FanAdapter.kt" target = "_blank"><ks>FanAdapter</ks></a>. Meanwhile Transport Trolley management is left exclusively to the manager himself and can be done using the <a href="../../Sprint2/src/adapters/TrolleyAdapter.kt" target = "_blank"><ks>TrolleyController</ks></a>. <br>
    Finally, <ks>PMS</ks> must be able to support some kind of timer which times car presence in the <ks>OUTDOOR AREA</ks> for more than 
    <a href="../../Sprint2/userDocs/Sprint3.html#problem_analysis_PMS" target = "_blank"><ks>DTFREE</ks></a> threshold.

   <!-- Dal backlog il PMS deve processare le richieste del manager e fornire a quest'ultimo le informazioni relative allo stato del sistema.
	Allo stesso modo di come è stato fatto negli sprint precedenti, l'introduzione di una nuova entità permette di gestire separatamente i task relativi al manager da resto del sistema.
	Per quanto riguarda lo stato del sistema da mostrare al manager, non si riscontrano particolari necessità, in quanto è possibile utilizzare la rappresentazione dello stato definita nel precedente Sprint (con link).
	Poichè le informazioni rappresentano lo stato corrente, ogni cambiamento dello stato deve essere notificato al manager in maniera istantanea.
	Passando alle operazioni che il manager può fare, queste dipendono dalla temperatura all'interno del parcheggio;  Questo dovrebbe essere notificato in maniera opportuna ed evidente in caso in cui la temperatura superi la soglia TMAX. per evitare la possibilità di errori umani la gestione della fan dovrebbe essere fatta in maniera automatica interagendo con FanAdapter(link) per cambiare il suo stato.
	La gestione del trolley è compito esclusivo del manager in prima persona e si può fare utilizzando il TrolleyController(link).
	Per ultimo il pms deve utilizzare qualche tipo di timer per controllare la presenza di una macchina nella outdoor area per più di DTFREE time. Per quanto riguarda DTFREE rifarsi a quanto detto nello sprint precedente (link). -->
	
  </div>
  <h3>ParkServiceStatusGUI</h3>
  <div class="remark" id="problem_analysis_parking_service_GUI">
      <ks>ParkServiceStatusGUI</ks> is a user interface which allows managers to interact with the parking system and has already been analyze <a href="../../requirements/userDocs/Automated Car-Parking.html#problem_analysis_parking_service_status_GUI" target = "_blank">here</a>. 
  </div>
  <h4>ParkServiceGUI - PMS interaction</h4>
  <div class="remark">
    Interaction between these two entites takes place through different messages pointed out
    <a href="../../requirements/userDocs/Automated Car-Parking.html#problem_analysis_parking_service_GUI" target = "_blank">here</a> using the same communication logic
    already detailed (<b>request/response</b> and <b>dispatches</b>).
    Data relative to the parking state can be exchanged using:
    <ul>
      <li><b>POLLING</b>: requests are continuously sent by the GUI. This methodology affects client performance.</li>
      <li><b>Open communication channel</b>: PMS continuously send new data to the client side. This methodology affects server performance.</li>
    </ul>
    Both methodoly can be deployed using <b>HTTP protocol</b> or <b>Websocket</b>. <br>
	 Alarm management can be treated in the same way, but the polling mode doesn't really fit this scenario as the alarm event occurs discontinuously and not periodically differently from the change in the general state of the system.
  </div>
  <div class="remark">
    A model of the two entites and their interaction is available <a href="../src/model2_sprint3.qak" target = "_blank">here</a>.
  </div>
  <h3>Login feature</h3>
  <div class="remark" id="problem_analysis_login_feature">
    Since only parking managers should be able to perform tasks previously described, an authentication form must be deployed into the application. This brings the attention on how
    ParkServiceStatusGUI web page should be protected from undesiderd users and how to properly store managers credentials. The first point can be accomplished by easily deploy a login 
    page which must redirects unauthorized users which try to access ParkServiceStatusGUI. The deployment can be faster achieved by using 
    <a href="https://spring.io/guides/gs/securing-web/" target = "_blank"><b>spring-boot-starter-security</b></a> which meets spring boot framework already used to build ParkServiceGui.
    At the same time managers' credentials should be stored in a dislocated server and crypted with any kind of hash function such as SHA-256 or MD5 to provent dictionary or injection attacks. However, for the sake of semplicity we can consider the deploy server for the ParkServiceStatusGUI safe and store credentials clearly in a file.
  </div>




  <h4>Test Unit</h4>
  <div class="remark">
	In this functional test we consider the right interaction between <ks>ParkServiceGUI</ks> and <ks>ParkManagerService</ks>. In particular, we will analyzing some core functionalities 
  such as parking state updates, high temperature alarm, trasport trolley interaction and manager login.


  <!--
  In particolare si andrà
	ad analizzare che il manager sia in grado di ricevere gli aggiornamenti sullo stato del sistema dal pms, che riceva l'alert sul raggiungimento della temperaturaMAX limite
	e che infine riesca a disattivare e riattivare il trolley a proprio piacimento. sono stati esclusi test riguardanti l'accendimento e lo spegnimento perche come specificato sopra
	è escluso lo scenario di una fan direttamente governabile da un umano. Infine si progetteranno dei test per gestire la fase di login per l'accesso alla schermata principale.-->

    Given the following assumption:
    <ul>
      <li>Manager logged.</li>
    </ul>
    <pre>
      <b>PARKSTATE</b>
	    PMS -> <ks>monitor</ks>
      check if response data contains right data from parking status
    </pre>
    Given the following assumptions:
    <ul>
      <li>Manager logged.</li>
      <li><ks>FAN</ks> <b>OFF</b></li>
    </ul>
    <pre>
      <b>FAN ACTIVATION</b>
	   <ks>PMS</ks> check if TA > TMAX
     <!-- adpter -> <ks>temperature HIGH</ks> -->
      PMS -> TURN_ON 
	    check if fan_state = <b>ON</b>
    </pre>
    Given the following assumptions:
    <ul>
      <li>Manager logged.</li>
      <li><ks>FAN</ks> <b>ON</b></li>
    </ul>
    <pre>
      <!-- controllo automatico della fan -->
      <b>FAN DE-ACTIVATION</b>
	   <ks>PMS</ks> check if TA <= TMAX
        PMS -> TURN_OFF
	      check if fan_state = <b>OFF</b>
    </pre>
    Given the following assumptions:
    <ul>
      <li>Manager logged.</li>
	    <li>TA < TMAX</li>
    </ul>
    <pre>
      <b>TROLLEY START/STOP</b>
      manager -> STOP 
      <!--PMS -> manage-->
      check if trolley state = <b>STOPPED</b>
      manager -> START 
	    check if trolley state = <b>WORKING</b>
    </pre>
	
  </div>


</div>
The Sprint 4 should be done in <b>four days</b>.
<div id = "project">
<h2>Project</h2>
Starting from what stated in the analysis phase, we introduce a new entity called <ks>parkManagerService</ks>, taking part of the <ks>PMS</ks>
which processes managers' requests.<br>
The <ks>ParkServiceManagerGUI</ks> takes part of the MVC architecture developed in the Sprint 3. This pattern requires to split the ParkServiceManagerGUI into two components (Model not needed in our case):
<ul>
  <li><b>View</b>: user interfaces.</li>
  <li><b>Controller</b>: receives requests and generates content view for the manager and manage communication between the bew client and the PMS.</li>
</ul>
<br>
In addition, <a>parkingState</a> resource has been updated with a new information that encodes an high temperature situation measured in the park.
<h4><a>parkManagerService</a></h4>
<table>
  <tbody>
    <tr>
    <td style="width: 50%; vertical-align:top">
      <br>
      In order to accept, queue and process different requests in a non-blocking manner, the parkClientService is implemented as an actor which has
      multiple status to exploit different tasks. parkClientService logic is message-based so that its state changes are triggered by message or events.<br>
      The parkManagerService costantly provides information about current park status to the manager and manages trolley requests while the fan is managed automatically by the <ks>PMS</ks>, in particular by the <a>temperature adapter</a>.
      The scheme on the side shows parkClientService behaviour.
    </td>
    <td>
      <center>
        <img src="IMG/parkManagerService_FSM.png" alt="parkManagerService_FSM" width="70%">
      </center>
    </td>
    </tr>
  </tbody>
</table>
<table width="100%">
  <tbody>
    <tr>
      <td>
        <h4>parkManagerService communication</h4>
        parkClientService interacts with <a href="#GUIAdapter">GUIAdapter</a>, developed in the previous Sprint and updated with new features described <a>below</a>, from which receives client's requests and to which sends tasks outcomes using a <b>request/response logic</b>.
        <br>
        In order to send QAK understandable messages, GUIAdapter uses <a>connQakTcp.kt</a> and <a>MsgUtil.kt</a>.<br>
      </td>
    </tr>
  </tbody>
</table>
<h4>ParkManagerServiceGUI</h4>
In order to get the current state of the park, we used a polling strategy which makes request every five seconds. It has been choosen since the manager GUI requires frequent live updates and polling fits well since it is not involved any real-time interval constraint. <br>
Meanwhile the alarm related to the outdoor area and the high temperature notification requires the server pushing over the client. In order to achieve this architectural paradigm, communication is based over websockets included in the Spring Boot framework as explained <a href="https://docs.spring.io/spring-framework/docs/4.3.x/spring-framework-reference/html/websocket.html" target = "_blank">here</a>.
Websocket has also been used since those events might occur rarely. This solution avoids web overloading.
<br><br>
<table>
  <tbody>
    <tr>
      <td style="width: 50%; vertical-align:top">
        <h4 id = "GUIAdapter"><a>GUIAdapter</a></h4>
        The GUIAdapter developed in the last Sprint has been expanded with new methods to fulfill manager's requests.<br>
        Moreover GUIAdapter aim is to open the connection via websocket and add new callback functions to the temperature and outdoor adapter which are called when their events occur.
      </td>
      <td>
        <center>
          <img src="IMG/GUiAdpater_class.jpg" width="30%">
        </center>
      </td>
    </tr>
    <tr>
      <td>
      <h4>ParkManagerServiceView</h4>
      Multiple html files have been written to represents client views:
      <ul>
        <li><a>login.html</a></li>
        <li><a>homeMgmt.html</a></li>
      </ul>
      Together with this pages JavaScript files are included to create the requests to the controller. They also dynamically modify html's DOM.
    </td>
    </tr>
  </tbody>
</table>
<h3>Security</h3>
<div class="remark">
The login and logout process has been secured using <a href="https://spring.io/guides/gs/securing-web/"SpringBoot Security</a> as suggested in the analysis phase. This feature has been implemented through (<a>WebSecurity.kt</a>) which contains the security policy.
For more simplify case the user and password has been saved in a file. This should be improve in future reviews.
</div>
<br>
The sequence diagrams below shows the main interaction between the components of this Sprint.
<br>
<table width="100%">
  <tr>
    <td style="width: 50%; vertical-align:top">
      <center>
        <img src="IMG/1.jpg" width="70%">
      </center>
    </td>
    <td>
      <center>
        <img src="IMG/2.jpg" width="70%">
      </center>
    </td>
  </tr>
  <tr>
    <td style="width: 50%; vertical-align:top">
      <center>
        <img src="IMG/3.jpg" width="70%">
      </center>
    </td>
    <td>
      <center>
        <img src="IMG/4.jpg" width="70%">
      </center>
    </td>
  </tr>
</table>

<h2>Testing</h2>
<div class="remark">
Starting from what as been said in the analysis phase, the integration tests have been developed as follow:
<ul>
  <li><a>TEST #1 - no queue task</a></li>
  <li><a>TEST #2 - complete cycle of tasks</a></li>
  <li><a>TEST #3 - halt functionality</a></li>
<ul>
</div>

<h4>Summary point</h4>
<center><img src="IMG/summaryPoint.jpg" alt="summary_point" width="50%"></center>
<h2>Deployment</h2>
<div class="remark">
</div>

<h2>Job task</h2>
<table cellpadding="5%">
  <tr>
    <th>Member</th>
    <th>Task done</th>
  </tr>
  <tr>
    <td><center><b>Manfreda Filippo</b><br>filippo.manfreda@studio.unibo.it</center></td>
    <td>
      <ul>
        <li>parkClientService</li>
      </ul>
    </td>
  </tr>
  <tr>
    <td><center><b>Andrini Enrico</b><br>enrico.andrini2@studio.unibo.it</center></td>
    <td>
      <ul>
        <li>GUIAdapter</li>
      </ul>
    </td>
  </tr>
  <tr>
    <td><center><b>Cristaudo Giuseppe</b><br>giuseppe.cristaudo@studio.unibo.it</center></td>
    <td>
      <ul>
        <li>ParkServiceView</li>
      </ul>
    </td>
  </tr>
  <tr>
    <td><center><b>Team</b></center></td>
    <td>
      <ul>
        <li>Problem analysis;</li>
        <li>Testing;</li>
        <li>Deployment</li>
      </ul>
    </td>
  </tr>
</table>
<h2>Sprint Review</h2>
<div class="remark">
</div>
<h2>Maintenance</h2>

<!-- USEFUL
<table style="width:100%" border="1">
<tr>
<td style="width:50%">
</td>
<td></td>
</tr>
</table>
-->

<br/><br/>
</div>

<div style="background-color:rgba(86, 56, 253, 0.9); width:60%;text-align:left;color:white">
By Cristaudo Giuseppe, Manfreda Filippo, Andrini Enrico; email: giuseppe.cristaudo@studio.unibo.it, filippo.manfreda@studio.unibo.it, enrico.andrini2@studio.unibo.it
<!--<img src="./img/emiglio.png" alt="mbot" width="15%" height="15%">-->
</div>
</body>
</html>
