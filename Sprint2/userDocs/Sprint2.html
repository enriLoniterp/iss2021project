<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
    <!--
<link rel="stylesheet" type="text/css" href="../css/issStyle1.css">
<script type="text/javascript" src="../css/issStyle.js"></script>
-->
<style type="text/css">
body
{
    margin-left:  30px;
    margin-right: 30px;
};

P
{
    font-family: Tahoma;
    font-size: 10pt;
};

a, a:visited, a:active, a:link, a:hover {
    text-decoration: underline;
    color: #545454;
    background-color: transparent;
	font-size: 93%;
}

a:hover {
    background-color: #cccccc;
}


hr {
    clear: both;
    height: 1px;
    color: #242424;
    background-color: transparent;
}

h1, h2, h3 {
    color: #242424;
    clear: left;
    font: 100% Tahoma, Helvetica, Arial, sans-serif;
    margin-bottom: 0.5em;
    padding-top: 0.5em;
	border-radius: 10px;
	padding: 5px;
}

top {
	width: 100%;
}


#i {
    color: #ff1010;
}
tt{
	font-family: "Arial";
    font-size: 90%;
	color: #006600;
}
em{
	font-family: "Arial";
    font-size: 80%;
	font-weight: bold;
	border-style:solid;
	border-color: #abe876;
    color: #1632cc;
}
bc{
	font-family: "Arial";
	font-size: 90%;
	font-weight: bold;
    color: #990000;
	background-color: #fcf8c7;
}
ks{
	font-family: "Arial";
	font-weight: bold;
    color: #0000CD	;
	font-size: 90%;
}
kc{
	font-family: "Arial";
	font-weight: bold;
    color: #008000	;
	font-size: 90%;
}
kr{
	font-family: "Arial";
	font-weight: bold;
    color: #ff0000	;
	font-size: 90%;
}
pre{
	font-family: "Consolas";
	font-size: 85%;
	background-color: #f5f5f5;
	border: 1.5px solid silver;
	padding: 5px;
}
m{
	font-family: "Helvetica";
	line-height: 100%;
 	font-size: 75%;
}
div.body{

    font-size: 18px;
}
k{
    color: #990000;
	font-weight: bold;
	font-size: 90%;
}
h1 {
    font-size: 150%;
    background-color: #b2c0ff;
	padding: 10px;
}

h2 {
    background-color: #9ed8ff;
    font-size: 130%;
}

h3 {
	background-color: #e6ccff;
    font-size: 100%;
}
h4 {
    background-color: #ccffcc;
    font-size: 100%;
	width: 95%;
	border-radius: 5px;
	padding: 2px;
}
h5 {
    background-color: #d5ffb0;
    font-size: 100%;

}
div.req{
	background-color: #d9ffb3;
    font-size: 18px;
	width: 700px;
    border: 3px solid green;
    padding: 15px;
    margin: 10px;
}
div.remark{
	background-color: #E3F2FD;
    border: 1.5px solid #d5f2ed;
    padding: 15px;
    margin: 10px;
	border-radius: 25px;
}
table, th, td {
  border: 1px solid black;
  border-collapse: collapse;
}

#exampleclass tbody,
#exampleclass thead,
#exampleclass th {
  border: 0;
}

ol, ul, li {
  margin: 0;
  margin-left: 10px;
  padding: 0;
  padding-bottom: 5px;
}

table, th, td {
	border: 1px solid black;
}

img {
	border: 1.5px solid #d5f2ed

}

a, a:visited, a:active, a:link, a:hover {
    text-decoration: underline;
    color: #545454;
    background-color: transparent;
}

div.wrapdesc{
	width: 90%;
	margin: auto;
}

div.imagedesc{
	width: 85%;
	margin: auto;
}
</style>

<head>

<title>Final task ISS-2021 Bologna: Automated Car-Parking - Sprint 2</title></head>

<body>
<div id="top">
<h1>Final task ISS-2021 Bologna: Automated Car-Parking - Sprint 2<font size="5"></font> </h1>
</div>

<div class="body">
<div id = "backlog">
  <h2>Sprint 2 Backlog</h2>
  <div class="remark">
    Sprint 2 regards the develop of the <ks>PMS</ks> basic functionalities - transport trolley:
    <ul>
      <li><ks>PMS</ks> manages transport trolley: <a href="../../requirements/userDocs/Automated Car-Parking.html#R2A" target = "_blank">R2A</a>,
        <a href="../../requirements/userDocs/Automated Car-Parking.html#R2C" target = "_blank">R2C</a>,
        <a href="../../requirements/userDocs/Automated Car-Parking.html#R2D" target = "_blank">R2D</a>,
        <a href="../../requirements/userDocs/Automated Car-Parking.html#R2E" target = "_blank">R2E</a>,
        <a href="../../requirements/userDocs/Automated Car-Parking.html#R3A" target = "_blank">R3A</a>,
        <a href="../../requirements/userDocs/Automated Car-Parking.html#R3B" target = "_blank">R3B</a>,
        <a href="../../requirements/userDocs/Automated Car-Parking.html#R3C" target = "_blank">R3C</a>,
        <a href="../../requirements/userDocs/Automated Car-Parking.html#R3D" target = "_blank">R3D</a>;</li>
    </ul>
  </div>
</div>
<h4>Starting point</h4>
<center><img src="IMG/StartingPoint.png" alt="starting_point_sprint1" width="40%"></center>


<div id = "problem_analysis">
<h2>Problem analysis</h2>
<div class="remark">
  This Sprint aim is to develop and deeper describe the following entities:
  <ul>
    <li><ks>PMS</ks>;</li>
    <li><ks>Transport trolley</ks>;</li>
  </ul>
</div>
<div class = "remark">
  An initial model of these entities, without interaction between them, can be found <a href = "https://github.com/enriLoniterp/iss2021project/blob/main/Sprint1/model1/src/model1.qak" target = "_blank">here</a>.<br>
</div>
<div id = "problem_analysis_PMS">
  <h3>PMS</h3>
  <div class = "remark">
    From the <a href="#backlog">backlog</a>, the <ks>Park Manager Service</ks> needs to manage the transport trolley. <br>
    As we said in the previous Sprint, also in this case we believe that it is appropriate to introduce a new entity that is
    part of the <ks>PMS</ks> which aim is maintain the status and manage the interaction with the <ks>transport trolley</ks>.
    The introduction of this new entity would allow the rest of the <ks>PMS</ks> to perform other tasks without blocking it.
  </div>
  <h4>Communication</h4>
  <div class="remark">
    Communication with the transport rolley can be done using a <b>request-response</b> or <b>dispatch logic</b>.
    The use of requeste-response does not negatively affect the system if the entity discussed in the previous paragraph is introduced
  </div>
</div>
<h3>Transport trolley</h3>
<div class = "remark">
  This component, as stated in the <a href="../../requirements/userDocs/Automated Car-Parking.html#problem_analysis_transport_trolley" target = "_blank">first analysis</a>, moves within the parking area by moving to certain points:
  <ul>
    <li>HOME;</li>
    <li>INDOOR AREA;</li>
    <li>OUTDOOR AREA;</li>
    <li>1 out of 6 SLOTS.</li>
  </ul>
  These shifts can be considered as "<b>MACRO</b>" shifts composed of a succession of "<b>MICRO</b>" shifts which depends on the actual position
  of the transport trolley. In addition, as per requirements, the transport trolley switchs between three states and
  can be blocked during its execution by the manager.
  As analysts, we think that the transport trolley can only be blocked after completing a macro move. This behaviour implies the need
  of saving what the trolley transport was doing before it was blocked in order to continue doing the right task after the resume. <br>

  Finally, the transport trolley in order to complete its tasks, needs a rapresentation of the parking area through a
   <a href="../../requirements/userDocs/Automated%20Car-Parking.html#problem_analysis_map" target = "_blank">map</a>. <br>
  The customer has made several resources available for this entity, which can be used in the project phase:
  <ul>
    <li><a href="https://htmlpreview.github.io/?https://github.com/anatali/issLab2021/blob/main/it.unibo.qak21.basicrobot/userDocs/basicrobot2021.html" target = "_blank">basicRobot</a>: component that executes robot-move commands in a 'technology-independent way', with respect
                           to the nature of the robot (virtual or real);</li>
    <li><a href="https://htmlpreview.github.io/?https://github.com/anatali/issLab2021/blob/master/it.unibo.cautiousExplorer/userDocs/BasicStepRobotActorUsage.html#distrSys" target = "_blank">basicStepRobot</a>: actor which performs basic moves and step and returns info to its owner;</li>
    <li><a href="https://htmlpreview.github.io/?https://github.com/anatali/issLab2021/blob/master/it.unibo.cautiousExplorer/userDocs/LabPlanner2021.html" target = "_blank">plannerUtil</a>: Kotlin object for planning the actions of a robot working in logical space (a map) composed of a set of square cells, each large as the robot.</li>
  </ul>
</div>
</div>
The Sprint 2 should be done in <b>five days</b>.
<div id = "project">
<h2>Project</h2>
Starting from the <a href="../../requirements/userDocs/Automated%20Car-Parking.html#architectural_model" target = "_blank">logical architecture</a>
and from the <a href="#backlog">product backlog</a> we can now and design the <ks>transport trolley</ks> and its managment.<br>
We maintain the <b>hexagonal architecture</b>, introduced in the previous sprint, developing port and adapter. This allows to keep separate the
technology indipendent part from the technology dipendent one.
<h4>Technology indipendent</h4>
<table cellpadding="5%">
  <tr>
    <td width = "50%">
      As said in the analysis phase, we introduce a new entity <a href="" target = "_blank">TrolleyController</a> which takes care
      of maintaining the current state of the <ks>transport trolley</ks> (<b>idle</b> / <b>working</b> / <b>stopped</b>) and manages the interaction with it, allowing the rest of the <ks>PMS</ks> to
      carry out other activities. Given the state nature of this entity, it is modeled as FSM actor (<a href="https://htmlpreview.github.io/?https://github.com/anatali/issLab2021/blob/master/it.unibo.qakactor/userDocs/LabQakIntro2021.html" target = "_blank">Qakactor</a>).<br>
      To solve the problem indicated in the analysis phase relating to the stop of the transport trolley, a variable (<b>nextTask</b>) has been introduced that
      takes on different values ​​relating to the task it has to carry out after being resumed.
    </td>
    <td>
      <center>
        <img src="IMG/specification.jpg" alt="specifications_common_to_all_sensors" width="100%">
      </center>
    </td>
  </tr>
</table>
<h3>Outsonar</h3>
<div class="remark">
  The outsonar have to be a physical sensor attached to a <b>Raspberry Pi</b>.
  For the sake of simplify the developed and because a real outsonar can generate spurios data, we decided to use the code in
  <a href="https://github.com/anatali/issLab2021/tree/main/it.unibo.rasp2021" target = "_blank">rasp2021</a> as a staring point..<br>
  The image below shows the model used in our application.
  <center><img src="IMG/sonar_pipe.jpg" alt="sonar_pipe" width="60%"></center>
  Last <a href="https://github.com/enriLoniterp/iss2021project/blob/main/Sprint1/outsonar/src/it/unibo/sonar/Sonar.kt" target = "_blank">actor</a> in the pipe
  has been modified in order to emit events only if the new distance measured is different from the previously one. This feature allows the <ks>PMS</ks> to handle
  less information.
  In addiction, data from the sonar can be simulated using <a href="https://github.com/anatali/issLab2021/blob/main/it.unibo.rasp2021/codedqak/sonarSimulator.kt" target = "_blank">sonarSimulator.kt</a>.
  The <a href="https://github.com/enriLoniterp/iss2021project/blob/main/Sprint1/outsonar/sonar2021ConfigKb.pl" target = "_blank">configuration file</a> allows to choose beetween the real and the simulated sonar.
</div>
<h4>PMS interaction with outsonar</h4>
<div class="remark">
  <table>
    <tr>
      <td width="50%">
        With regard to <ks>outsonar</ks>, the adapter(<a href="https://github.com/enriLoniterp/iss2021project/blob/main/Sprint1/sensors/src/main/kotlin/outsonar/OutSonarAdapter.kt" target = "_blank">OutSonarAdapter.kt</a>)
        maintains the last value generated by the outsonar and implements the method <i>getValue()</i>
        of the interface, which allows the rest of the application to know the actual value of this sensor.
        The callback class(<a href="https://github.com/enriLoniterp/iss2021project/blob/main/Sprint1/sensors/src/main/kotlin/outsonar/OutSonarCallback.kt" target = "_blank">OutSonarCallback.kt</a>)
        receives the message, processes them using the <a href = "https://github.com/anatali/issLab2021/blob/main/it.unibo.qakactor/src/main/kotlin/ApplMessage.kt" target = "_blank">ApplMessage.kt</a>
        and updates the adapter state variable.
      </td>
      <td>
        <center>
          <img src="IMG/outsonar.jpg" alt="outsonar" width="80%">
        </center>
      </td>
    </tr>
  </table>
</div>
<h3>Weightsensor</h3>
<div class="remark">
  <table>
    <tr>
      <td width="50%">
        Since there aren't particular requirements for the weightsensor, it has been developed as a mock object <a href="https://github.com/enriLoniterp/iss2021project/blob/main/Sprint1/sensors/src/main/kotlin/weightsensor/WeightSensorMockMQTT.ipynb" target = "_blank">WeightSensorMock</a>
        that periodically emits events.
        The data sent by the mock can be generated by manually input new values or randomly.
        As previously described, the component integration strategy uses MQTT protocol and paho as a client. <br>
        Due to same kind of interaction as the outsonar, we can basically use the same classes used with the oursonar and refactor variables and the data we need for this sensor.
        For that reason the <a href="https://github.com/enriLoniterp/iss2021project/blob/main/Sprint1/sensors/src/main/kotlin/weightsensor/WeightSensorAdapter.kt" target = "_blank">WeightSensorAdapter.kt</a> and the
        <a href="https://github.com/enriLoniterp/iss2021project/blob/main/Sprint1/sensors/src/main/kotlin/weightsensor/WeightSensorCallback.kt" target = "_blank">WeightSensorCallback.kt</a> works as their outsonar counterparts.
      </td>
      <td>
        <center>
          <img src="IMG/weightsensor.png" alt="weightsenor" width="80%">
        </center>
      </td>
    </tr>
  </table>
</div>
<h3>Thermometer</h3>
<div class="remark">
  <table>
    <tr>
      <td width="50%">
        As for the weightsensor, the thermometer has been developed as a mock object <a href="https://github.com/enriLoniterp/iss2021project/blob/main/Sprint1/sensors/src/main/kotlin/thermometer/ThermometerMockMQTT.ipynb" target = "_blank">ThermometerMock</a> that periodically emits events. It works like the
        WeightSensorMock but the value randomly generated range from -10 to 50 degrees.<br>
        Again, due to the same type of interaction,  we developed <a href="https://github.com/enriLoniterp/iss2021project/blob/main/Sprint1/sensors/src/main/kotlin/thermometer/ThermometerAdapter.kt" target = "_blank">ThermometerSensorAdapter.kt</a>
        and <a href="https://github.com/enriLoniterp/iss2021project/blob/main/Sprint1/sensors/src/main/kotlin/thermometer/ThermometerCallback.kt" target = "_blank">ThermometerCallback.kt</a> reusing the code previously
        detailed.
      </td>
      <td>
        <center>
          <img src="IMG/thermometer.png" alt="thermometer" width="80%">
        </center>
      </td>
    </tr>
</table>
</div>
</div>


<h2>Testing</h2>
<div class="remark">
Since Sprint 2 is focused on the transport trolley, test plans will be carry out testing the "MACRO" moves priovously described (R2A, R2C/R3B, R2D/R2E/R3D, R3C),
without taking care on particular situation where the transport trolley can't start its task (R1/R3). These situation will be included in future sprints. <br>
For that reason, we assumed the following starting assumptions:
<ul>
  <li>INDOOR and OUTDOOR AREA are not engaged;</li>
  <li>FAN turned off;</li>
  <li>No Magager interaction;</li>
  <li>Transport trolley starts from home location;</li>
  <li>All parking slots are free.</li>
</ul>
Hereafter is a description of the functional tests for this sprint:
<pre>
  <a>TEST #1 - no queue task</a>
  creation of an istance of <b>adapter</b>
  robot -> <ks>moveToIn</ks>
  check if coordinates(<b>robot</b>) == coordinates(<b>INDOOR AREA</b>)
  no task in queue
  <!-- robot -> <ks>moveToHome</ks> -->
  check if coordinates(<b>robot</b>) == coordinates(<b>HOME</b>)
</pre>
<pre>
  <a>TEST #2 - complete cycle of tasks</a>
  creation of an istance of <b>adapter</b>
  robot -> <ks>moveToIn</ks>
  check if coordinates(<b>robot</b>) == coordinates(<b>INDOOR AREA</b>)
  robot -> <ks>moveToSlotIn(3)</ks>
  check if coordinates(<b>robot</b>) == coordinates(1,3)
  robot -> <ks>moveToSlotOut(4)</ks>
  check if coordinates(<b>robot</b>) == coordinates(4,1)
  robot -> <ks>moveToOut</ks>
  check if coordinates(<b>robot</b>) == coordinates(<b>OUTDOOR AREA</b>)
  robot -> <ks>moveToHome</ks>
  check if coordinates(<b>robot</b>) == coordinates(<b>HOME</b>)
</pre>
<pre>
  <a>TEST #3 - halt functionality</a>
  creation of an istance of <b>adapter</b>
  robot -> <ks>moveToIn</ks>
  check if coordinates(<b>robot</b>) == coordinates(<b>INDOOR AREA</b>)
  robot -> <ks>halt</ks>
  no task in queue
  robot -> <ks>resume</ks>
  <!-- robot -> <ks>moveToHome</ks> -->
  check if coordinates(<b>robot</b>) == coordinates(<b>HOME</b>)
</pre>
</div>

<h4>Summary point</h4>
<center><img src="IMG/esagono.jpg" alt="summary_point" width="50%"></center>
<h2>Deployment</h2>
<div class="remark">
  In this Sprint we decided to deploy the driven side which includes outsonar, thermometer and weightsensor,
  while ports and adapters will be deployed in future Sprints. <br>
  <a href ="https://github.com/enriLoniterp/iss2021project/blob/main/Sprint1/sensors/src/main/kotlin/thermometer/ThermometerMockMQTT.ipynb" target = "_blank">Thermometer</a>
  and <a href ="https://github.com/enriLoniterp/iss2021project/blob/main/Sprint1/sensors/src/main/kotlin/weightsensor/WeightSensorMockMQTT.ipynb" target = "_blank">weightsensor</a> can be used by opening and running them with jupyter.
  <br>
  Regarding to the <ks>outsonar</ks>, it has been deployed using <em>gradle distZip</em> command. The result of the deployment is a zip file <a href="https://github.com/enriLoniterp/iss2021project/blob/main/Sprint1/outsonar/distributions/it.unibo.rasp2021-1.0.zip" target = "_blank"><em>outsonar.zip</em></a>
  that contains a bin directory with the executables. By default the system uses a real sonar and in that case <a href="https://github.com/enriLoniterp/iss2021project/blob/main/Sprint1/outsonar/SonarAlone" target = "_blank">sonarAlone.c</a> needs to be compiled.
  Alternatevely, by changing configuration file <a href="https://github.com/enriLoniterp/iss2021project/blob/main/Sprint1/outsonar/sonar2021ConfigKb.pl" target = "_blank">sonar2021ConfigKb.pl</a> a virtual sonar can be used.
  In addicition, the broker that receives events emitted by the sonar can be choose by editing <a href="https://github.com/enriLoniterp/iss2021project/blob/main/Sprint1/outsonar/sonaronrasp.pl" target = "_blank">sonaronrasp.pl</a>.<br>
  To run the system on:
  <ul>
    <li><b>Windows</b>: open a Command Prompt, set working directory to <em>bin</em>, run <em>outsonar.bat</em>;
    <li><b>Unix</b>: open a Bash Shell, set working directory to <em>bin</em>, run <em>bash outsonar</em>;
    <li><b>MacOS</b>: open a Terminal, set working directory to <em>bin</em>, run <em>basicdevices</em>;
</div>

<h2>Job task</h2>
<table cellpadding="5%">
  <tr>
    <th>Member</th>
    <th>Task done</th>
  </tr>
  <tr>
    <td><center><b>Andrini Enrico</b><br>enrico.andrini2@studio.unibo.it</center></td>
    <td>
      <ul>
        <li>Weighsensor</li>
      </ul>
    </td>
  </tr>
  <tr>
    <td><center><b>Cristaudo Giuseppe</b><br>giuseppe.cristaudo@studio.unibo.it</center></td>
    <td>
      <ul>
        <li>Thermometer</li>
      </ul>
    </td>
  </tr>
  <tr>
    <td><center><b>Manfreda Filippo</b><br>filippo.manfreda@studio.unibo.it</center></td>
    <td>
      <ul>
        <li>Outsonar</li>
      </ul>
    </td>
  </tr>
  <tr>
    <td><center><b>Team</b></center></td>
    <td>
      <ul>
        <li>Problem analysis;</li>
        <li>Testing;</li>
        <li>Deployment</li>
      </ul>
    </td>
  </tr>
</table>
<h2>Sprint Review</h2>
<div class="remark">
During the discussion with the customer we faced the possibilty to use the observer pattern as a logic interaction instead of
the publish-subscribe we used. As analyst we think they are both good at satisfying our interction requirements with sensor. However,
we think publish-subscribe interaction suits best our needs because, as we said in <a href="http://htmlpreview.github.io/?https://github.com/enriLoniterp/iss2021project/blob/main/requirements/userDocs/Automated%20Car-Parking.html" target = "_blank">our first analiys</a>,
sensors doens't know who is going to use them, this specification is fully satisfied thanks to the presence of an intermediary: the broker. This means that the publisher (sensor) and subscriber
(adapter) are just loosely-coupled. Although the observer pattern allows you to not know a priori who the observers will be, they will be subsequently
disclosed to the sensors directly after the registration.
A closer look at this comparison can be found <a href="https://towardsai.net/p/systems/observer-pattern-vs-pub-sub-pattern" target = "_blank">here</a>.<br/>
Regarding the broker, even if now we rely on the remote broker hivemq, it will later be replaced by a local broker (<b>Mosquitto<b/>).

</div>
<h2>Maintenance</h2>

<!-- USEFUL
<table style="width:100%" border="1">
<tr>
<td style="width:50%">
</td>
<td></td>
</tr>
</table>
-->

<br/><br/>
</div>

<div style="background-color:rgba(86, 56, 253, 0.9); width:60%;text-align:left;color:white">
By studentName email: giuseppe.cristaudo@studio.unibo.it, filippo.manfreda@studio.unibo.it, enrico.andrini2@studio.unibo.it
<!--<img src="./img/emiglio.png" alt="mbot" width="15%" height="15%">-->
</div>
</body>
</html>
