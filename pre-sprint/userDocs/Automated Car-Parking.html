<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
    <!--
<link rel="stylesheet" type="text/css" href="../css/issStyle1.css">
<script type="text/javascript" src="../css/issStyle.js"></script>
-->
<style type="text/css">
body
{
    margin-left:  30px;
    margin-right: 30px;
};

P
{
    font-family: Tahoma;
    font-size: 10pt;
};

a, a:visited, a:active, a:link, a:hover {
    text-decoration: underline;
    color: #545454;
    background-color: transparent;
	font-size: 93%;
}

a:hover {
    background-color: #cccccc;
}


hr {
    clear: both;
    height: 1px;
    color: #242424;
    background-color: transparent;
}

h1, h2, h3 {
    color: #242424;
    clear: left;
    font: 100% Tahoma, Helvetica, Arial, sans-serif;
    margin-bottom: 0.5em;
    padding-top: 0.5em;
	border-radius: 10px;
	padding: 5px;
}

top {
	width: 100%;
}


#i {
    color: #ff1010;
}
tt{
	font-family: "Arial";
    font-size: 90%;
	color: #006600;
}
em{
	font-family: "Arial";
    font-size: 80%;
	font-weight: bold;
	border-style:solid;
	border-color: #abe876;
    color: #1632cc;
}
bc{
	font-family: "Arial";
	font-size: 90%;
	font-weight: bold;
    color: #990000;
	background-color: #fcf8c7;
}
ks{
	font-family: "Arial";
	font-weight: bold;
    color: #0000CD	;
	font-size: 90%;
}
kc{
	font-family: "Arial";
	font-weight: bold;
    color: #008000	;
	font-size: 90%;
}
kr{
	font-family: "Arial";
	font-weight: bold;
    color: #ff0000	;
	font-size: 90%;
}
pre{
	font-family: "Consolas";
	font-size: 85%;
	background-color: #f5f5f5;
	border: 1.5px solid silver;
	padding: 5px;
}
m{
	font-family: "Helvetica";
	line-height: 100%;
 	font-size: 75%;
}
div.body{

    font-size: 18px;
}
k{
    color: #990000;
	font-weight: bold;
	font-size: 90%;
}
h1 {
    font-size: 150%;
    background-color: #b2c0ff;
	padding: 10px;
}

h2 {
    background-color: #9ed8ff;
    font-size: 130%;
}

h3 {
	background-color: #e6ccff;
    font-size: 100%;
}
h4 {
    background-color: #ccffcc;
    font-size: 100%;
	width: 95%;
	border-radius: 5px;
	padding: 2px;
}
h5 {
    background-color: #d5ffb0;
    font-size: 100%;

}
div.req{
	background-color: #d9ffb3;
    font-size: 18px;
	width: 700px;
    border: 3px solid green;
    padding: 15px;
    margin: 10px;
}
div.remark{
	background-color: #E3F2FD;
    border: 1.5px solid #d5f2ed;
    padding: 15px;
    margin: 10px;
	border-radius: 25px;
}
table, th, td {
  border: 1px solid black;
  border-collapse: collapse;
}

#exampleclass tbody,
#exampleclass thead,
#exampleclass th {
  border: 0;
}

ol, ul, li {
  margin: 0;
  margin-left: 10px;
  padding: 0;
  padding-bottom: 5px;
}

table, th, td {
	border: 1px solid black;
}

img {
	border: 1.5px solid #d5f2ed

}

a, a:visited, a:active, a:link, a:hover {
    text-decoration: underline;
    color: #545454;
    background-color: transparent;
}

div.wrapdesc{
	width: 90%;
	margin: auto;
}

div.imagedesc{
	width: 85%;
	margin: auto;
}
</style>

<head>

<title>Final task ISS-2021 Bologna: Automated Car-Parking</title></head>

<body>
<div id="top">
<h1>Final task ISS-2021 Bologna: Automated Car-Parking<font size="5"></font> </h1>
</div>

<div class="body">


<h2>Introduction</h2>
<div id="Introduction">
  This document deals with the design, build and development of a software system, named <ks>ParkingManagerService</ks>,
  which implements a series of functions to manage an automating parking service.
</div>
<h2>Requirements</h2>
<div id="Requirements" class="remark">
  A detailed description of the requirements is available <a href="TFBO21ISS.pdf">here</a>
</div>

<h2>Requirement analysis</h2>
<div class="remark" toDo = "clarify the meaning of the names and of the verbs included in the requirement text given by the customer.">
  <div>
    Our <b>interaction with the customer</b> ha clarified that nouns have the following meanings:
    <ul>
      <li><ks>service</ks>: system of intercommunicating components based on a combination of hardware and software which handles interaction between human and machine;</li>
      <li><ks>automation functions</ks>: set of functions or tasks which <kr>ParkingManagerService</kr> runs without any kind of employee's interaction or supervision;</li>
      <li><ks>DDR Robot</ks>: physical or virtual (simulated in an virtual environment) object which can be represented and controlled using the infomation in <a href="./basicrobot2021.html">basicrobot2021</a>;</li>
      <li><ks>transport trolley</ks>: component which uses the <ks>DDR Robot</ks> in order to complete his tasks;</li>
      <li><ks>home</ks>: shelter or starting point located in the map defined in <a href="./parkingMap.txt">parkingMap.txt</a>;</li>
      <li><ks>weight sensor</ks>: virtual sensor which is able to simulate the behavior of a
                                 weight transducer which converts an input mechanical force such as load, weight,
                                 tension, compression, or pressure into another physical variable, in this case,
                                 into an electrical output signal that can be measured and converted. <br>
                                 Since the system interacts with cars, the weight sensor triggers only when a
                                 sufficient weight is placed on the footplate;</li>
      <li><ks>outsonar</ks>: physical tool capable to detect object that cross its trajectory. Data sent by the outsonar can be managed as described in <a href="./SonarAlone.c">SonarAlone.c</a>;</li>
      <li><ks>parking-area</ks>: area provided for the parking of vehicles and includes any parking spaces, ingress and egress lanes. For the purpose of the
                                 project, this area will be simulated in the <ks>WEnv</ks>;</li>
      <li><ks>empty room</ks>: section of a building which is enclosed by walls and a floor. The room also does not contain
                              anything. It isn't filled or occupied by any physical object;</li>
      <li><ks>INDOOR</ks>: fixed point of the map which marks where car can enter the parking;</li>
      <li><ks>OUTDOOR</ks>: fixed point of the map which marks where car can exit the parking;</li>
      <li><ks>INDOOR-area</ks>: detailed area of the map where the weight sensor is placed;</li>
      <li><ks>OUTDOOR-area</ks>: detailed area of the map where the out sonar is placed;</li>
      <li><ks>weight</ks>: body(car)'s relative mass or the quantity of matter contained by it;</li>
      <li><ks>parking-slots</ks>: fixed number (6) of place in a specific area of the map where car are or can be parked;</li>
      <li><ks>thermometer</ks>: virtual instrument which is able to simulate the behaviour of a real sensor which is situated inside the parking and able to
         measuring and indicating temperature;</li>
      <li><ks>fan</ks>: virtual object which is used to simulate the behaviour of a device for producing a current of air by the movement of a broad surface or a number of such surfaces;</li>
      <li><ks>map</ks>: abstract representation of the environment that delineates <ks>home</ks>, <ks>INDOOR</ks>, <ks>OUTDOOR</ks> and <ks>parking area</ks>.
      An example of the figure is shown below:
      <pre>                  |r, 0, 0, 0, 0, 0, 0, X,
                  |0, 0, X, X, 0, 0, 0, X,
                  |0, 0, X, X, 0, 0, 0, X,
                  |0, 0, X, X, 0, 0, 0, X,
                  |0, 0, 0, 0, 0, 0, 0, X,
                  |X, X, X, X, X, X, X, X,
      </pre></li>
      <li><ks>fixed obstacles</ks>: walls which marks the limit of the <ks>room</ks>;</li>
      <li><ks>WEnv</ks>: virtual environment which simulate the scene of the parking in order to simplify the development in a real context. The <ks>WEnv</ks> configuration is reported in <a href="./parkingAreaConfig.js">parkingAreaConfig.js</a>;</li>
      <li><ks>critical situations</ks>: anomalous situations not foreseen in advance and managed in a general way;</li>
      <li><ks>TOKENID</ks>: set of symbols which identify in an unique way cars parked in the system and which is used in the car pick up phase;</li>
      <li><ks>ParkServiceGUI</ks>: user interface which allows users to interact with the parking system and which shows the <ks>SLOTNUM</ks> and <ks>TOKENID</ks>
                                  and buttons  which help the user to park and retrieve their car;</li>
      <li><ks>ParkServiceStatusGUI</ks>: user interface which allows manager to interact with the parking system
                                        and which shows the <ks>current state</ks> of the parking area;
      <li><ks>SLOTNUM</ks>: integer that represents <ks>parking-slots</ks>;</li>
      <li><a id="current_state"><ks>current state</ks></a>: current situation of the entire system. It includes <ks>parking-slots</ks> availability,
                                 room <ks>temperature</ks>, state of the <ks>fan</ks> and state of the <ks>ParkingServiceGUI</ks>;</li>
      <li><ks>behaviour</ks>: status of <ks>transport trolley</ks>:
                            <ul>
                              <li><kr>Idle</kr>: has no duties to perform;</li>
                              <li><kr>Working</kr>: currently performing tasks;</li>
                              <li><kr>Stop</kr>: state driven manually by the manager or in an automatic mechanism when <ks>TA</ks> > <ks>TMAX</ks>;</li>
                            </ul>
      </li>
      <li><ks>alarm</ks>: signal which warn the manager of the system through the <ks>ParkServiceStatusGUI</ks>
                         when the <ks>OUTDOOR-area</ks> has not been cleaned within the <ks>DTFREE</ks> interval of time;</li>
      <li><ks>proper notice</ks>: warning sent to the user through the <ks>ParkServiceGUI</ks> if the <ks>INDOOR-area</ks> is already
                                engaged by a car;</li>
    </ul>
  </div>
  <div>
    Regarding action or verbs:
    <ul>
      <li><ks>equipped</ks>: the system is supplied with the necessary items for a particular purpose;</li>
      <li><ks>notify/inform</ks>: the interaction between the software system and the user and vice versa;</li>
      <li><ks>walk</ks>: the <ks>transport trolley</ks> moves in order to complete its task;</li>
      <li><ks>take over</ks>: the <ks>transport trolley</ks> picks up a car and carries it inside the parking;</li>
      <li><ks>observe</ks>: the <kr>ParkingManager</kr> monitors the <ks>current state</ks> of the system;</li>
      <li><ks>clean</ks>: the <ks>OUTDOOR-area</ks> is free;</li>
    </ul>
  </div>
</div>

<div id="user_stories">
  <div id="Main User Story">
    <h3>Main user story</h3>
    <table style="width:98%" cellpadding="5%">
      <tbody>
        <tr>
          <td style="width:70%">
           A client interacts with the <ks>ParkServiceGUI</ks> in order to park its car. The system, then checks if the <ks>INDOOR-area</ks> is free, and in that case
           it replies to the client with a number that identifies a free park-slot (<ks>SLOTNUM</ks>). At that time, if <ks>SLOTNUM</ks> > 0, the client receives a receipt with the
           <ks>TOKENID</ks>, enters the car and then the <ks>ParkingManagerService</ks> makes the transport trolley pick up the car <b>(1)</b> and moves it to the selected parking-slot <b>(2)</b>. <br><br>
           When the client wants his car back, he interacts again with the <ks>ParkServiceGUI</ks> by requesting a pick up of his car
           using the <ks>TOKENID</ks> previously received. At this time, the transport trolley carries the selected car from its parking-slot to the
           outdoor-area <b>(3)</b>. Finally, the client takes the car and frees the outdoor-area.
          </td>
          <td><center><img src="IMG/user_story_1.jpg" alt="TestPlan0" width="95%"></center>
          </td>
        </tr>
       </tbody>
    </table>
    <pre> Let assume the <ks>INDOOR-area</ks> is free and at least one parking slot is available:<br>
          Client notifies interest in entering the car<br>
          System return <ks>SLOTNUM</ks><br>
          assert 0 < <ks>SLOTNUM</ks> <= 6<br>
          Client <ks>CARENTER</ks><br>
          System return <ks>TOKENID</ks> and park the car<br>
          <b>wait</b><br>
          Client wants to pick up his car by sending <ks>TOKENID</ks><br>
          System moves the selected car to the <ks>OUTDOOR-area</ks><br>
          Client receives a confirm.
    </pre>
  </div>
<div id="user_story_standard_supervision">
  <h3>User story: normal parking manager's supervision</h3>
  <table style="width:98%" cellpadding="5%">
    <tbody>
      <td>
        While the <kr>ParkingMenagerService</kr> is working, it collects data of system current state. This includes the temperature (<ks>TA</ks>), state of the fan
        and the <ks>transport trolley</ks>. The manager can view this information by the GUI.
      </td>
    </tbody>
  </table>
</div>
<pre>
  System simulates the change of the current status<br>
  GUI checks if new changes appears.
</pre>
<div id="user_story_non_standard_supervision">
  <h3>User story: non standard parking manager's supervision</h3>
  <table style="width:98%" cellpadding="5%">
    <tbody>
      <td>
        When the system is working, the thermometer measures the temperature <ks>TA</ks>. If <ks>TA</ks> > <ks>TMAX</ks> the <kr>ParkingManagerService</kr> informs the <ks>ParkingServiceStatusGUI</ks>.
        Therefore the manager requests to stop the trasport trolley and activates the fan via the GUI.
        The system stops the <ks>transport trolley</ks> and waits until <ks>TA</ks> < <ks>TMAX</ks>. When this happens the manager sees it on the GUI and requests to activate the
        <ks>trasport</ks> trolley and to stop the fan using the GUI.
      </td>
    </tbody>
  </table>
</div>
<pre>
  <ks>Thermometer</ks> simulates a temperature <ks>TA</ks> > <ks>TMAX</ks><br>
  <b>wait</b> <br>
  System checks new fan and transport trolley status<br>
  Thermometer simulates a temperature <ks>TA</ks> < <ks>TMAX</ks><br>
  <b>wait</b> <br>
  System checks new <ks>fan</ks> and <ks>transport trolley</ks> status<br>
</pre>
<div id="alarm_situation">
  <h3>User story: DTFREE OUTDOOR-AREA </h3>
  <table style="width:98%" cellpadding="5%">
    <tbody>
      <td>
        Initially the outsonar detects the presence of a car in the <ks>OUTDOOR-area</ks> and refers it to the <ks>ParkManagerService</ks>. If the car is still waiting in the
        <ks>OUTDOOR-area</ks> within the <ks>DTFREE</ks> time the <kr>ParkManagerService</kr> sends an <b>ALARM</b> signal to the <ks>ParkServiceStatusGui</ks>. The manager is now aware of the situation.
      </td>
    </tbody>
  </table>
</div>
</div>
<pre>
  <ks>Outsonar</ks> simulates the presence of a car for a time <ks>T</ks> > <ks>DTFREE</ks><br>
  <ks>ParkServiceStatusGui</ks> checks if an alarm has been received<br>
</pre>

<h2>Problem analysis</h2>

<div class="remark">
  The system is made up of a series of distributed heterogeneous components that must communicate with each other.
  From their interaction arises the problem of evaluating the technologies to be used for the transmission of information in the best possible way.
  Another problem can be found in the management of the transport trolley as a core feature of the parking system.<br>
  For a first representation of the system it is possible to use the qak meta-modeling language provided by the customer,
  whose specifications are contained in this <a href="https://htmlpreview.github.io/?https://github.com/anatali/issLab2021/blob/master/it.unibo.qakactor/userDocs/LabQakIntro2021.html">document</a>.
</div>
  The following legend will be used to represent the components in the problem analysis. <br><br>
  <img src="IMG/legenda.png" alt="LEGEND" width="15%">

<div>
  <h4>System overview</h4>
  <table style="width:98%" cellpadding="5%">
    <tbody>
      <tr>
        <td style="width:60%" style="text-align:top">
          The side image shows a schematic view of the system, including components and users.<br>
          As can be seen from the image, the core system is the hub of the system and plays the role of mediator
          between components. For this reason, the central system is the same entity which elaborates information and schedules
          tasks for interacting components.
          The interaction between those entities takes place via network or via different networks using messages. Data transmission
          and message format will be described below.
        </td>
        <td><center><img src="IMG/SYSTEM OVERVIEW.jpg" alt="SystemOverview" width="90%"></center></td>
      </tr>
    </tbody>
  </table>
</div>
<div id="System_communication_overview">
  <h4>System communication overview</h4>
  <div class="remark">
    Since a distributed system is being developed, communication is a major aspect of the system itself. <br>
    Depending on the nature and task of each component of the system, they will need a different form of interaction.
    Those form of interaction can be generally expressed as <ks>synchronous</ks> or <ks>asynchronous</ks> communication. <br>
    Synchronous communication can be distinguish in:
    <ul>
      <li><b>request</b>/<b>response</b> semantic;</li>
      <li><b>invitation</b> semantic;</li>
    </ul>
    Meanwhile for the asynchronous communication there are:
    <ul>
      <li><b>dispatch</b> semantic;</li>
      <li><b>event</b> semantic;</li>
    </ul>
    Moreover, in order to use these semantic, the system can relies on different communication protocol:
    <ul>
      <li><ks>websocket</ks> for request/response, dispatch, invitation and event semantics;</li>
      <li><ks>HTTP</ks> for request/response and invitation semantics;</li>
      <li><ks>MQTT</ks> for event and dispatch semantics;</li>
      <li><ks>COaP</ks> for request/response, dispatch, invitation and event semantics.</li>
    </ul>
    Afterwards, for every component will be discussed the best communication solution according to its task.
  </div>
</div>
<h4>Components overview</h4>
<div>
  <h3> Transport Trolley </h3>
<div class="remark">
  <ks>Transport Trolley</ks> aim is reduced to two ventures: <br>
  <ul>
    <li>move the client's car from the indoor-area to the parking slot assigned;</li>
    <li>move the client's car from the given parking slot to the outdoot-area.</li>
  </ul>
  At any time, parking manager is allowed to stop these tasks. Transport trolley aim leads to both active and passive behaviour. <br>
  The choice of the best path that the transport trolley has to perform is not an easy operation. For this reason, this task should be delegated to an external entity.
  These two entities exchange messages following a synchronous communication so that the central system receives a feedback
  from the trasport trolley when it asks for an execution. <br> Alternatively, asynchronous communication could be used. However, this type of communication would force the system
  to have less knowledge of the current state of the transport trolley.
</div>
<img src="IMG/TRANSPORT TROLLEY.jpg" alt="TRANSPORTROLLEY" width="40%">
<h3> Fan </h3>
<div class="remark">
The <ks>fan</ks> does not own or produce any valuable information by itself but it is a component controlled by the system.
Fan status can be changed through two messages "<kr>turn_on</kr>" and "<kr>turn_off</kr>" respectively to turn it on and to turn it off. As a result of the command the fan can
only be in two states, one is "on" which indicates that the fun is working while the second one "off" suggests that the fun is not working.
The fan should also return in response the new current state in order to update the manager GUI.
This feature can also be used in case of electric disguise or general failure of the central system. The fan must respond with its current
state whenever the central system requests its state of activation.
</div> <br>
<table cellpadding="20%" style="border: 0px solid transparent;width:98%;" style="width:98%">
  <tr>
    <td style="border: 0px">
        <center><img src="IMG/FAN.jpg" alt="FAN" width="60%"><center>
    </td>
    <td style="border: 0px">
      <center><table cellpadding="5%">
        <tbody><tr>
            <th>Message</th>
            <th>Content</th>
            <th>Semantic</th>
        </tr>
        <tr>
            <td>req_status</td>
            <td>status</td>
            <td>request</td>
        </tr>
        <tr>
            <td rowspan="2">command</td>
            <td>turn_on</td>
            <td rowspan="2">request</td>
        </tr>
        <tr>
            <td>turn_off</td>
        </tr>
        <tr>
            <td rowspan="2">rep_status</td>
            <td>on</td>
            <td rowspan="2">reply</td>
        </tr>
        <tr>
            <td>off</td>
        </tr>
    </tbody></table></center>
  </td>
</tr>
</table>
<br>
<hr size="4" color="black">
<br>
<div class="remark">
  The sensors below don't need any replies during the interaction with the core system.
  Also, the analysis of the requirements shows that the <ks>outsonar</ks>, the <ks>thermometer</ks> and the <ks>weight-sensor</ks> are autonomous active
  components that are unaware of the existence of other components. <br>
  This behaviour leads to an asynchronous communication that can be developed through different forms:
  <ul>
    <li><b>Polling</b>: where the core system makes, at a regular interval of time, requests to sensors;</li>
    <li><b>Dispatches</b>: sent from sensor to the core system;</li>
    <li><b>Events</b>: generated from sensors and sent in broadcast through networks.</li>
  </ul>
  There are several protocol that can be used to interact with those components:
  <ul>
    <li><b>WebSocket</b>: two-way channel builded on a single TCP connection. This implies a more heavy-weight communication than the two below;</li>
    <li><b>MQTT</b>: decouples producer and consumer by letting clients publish and having the broker decide where to route and copy messages.
      It also does best as a communications bus for live data;</li>
    <li><b>CoAP</b>: a one-to-one restful protocol for transferring state information between client and server. It also meeting specialized requirements
      such as multicast support, very low overhead, and simplicity.
  </ul>
  In addition, all the sensors can be modeled as actors.
</div>

<div id="problem_analysis_out_sonar">
  <h3> Out-Sonar </h3>
  <div class="remark">
    Data from the <ks>out-sonar</ks> is used when a client starts the <ks>acceptOUT</ks> procedure and to trigger the alarm procedure
    if it detects a car in the <ks>OUTDOOR-AREA</ks> for more than <ks>DFTREE</ks> time. <br>
    In order to identify those situation, the <ks>out-sonar</ks> has to emit events every time the distance measured by the
    sensor change. Moreover, messages sent by the <ks>out-sonar</ks> contain the distance misured and the relative timestamp.
    Customer's <a href="./SonarAlone.c">SonarAlone.c</a> can be used in order to simplify the development of this component.
    <br>
  </div>
  <table cellpadding="20%" style="border: 0px solid transparent;width:98%;" style="width:98%">
    <tr>
      <td style="border: 0px">
          <center><img src="IMG/OUTSONAR.jpg" alt="OUTSONAR" width="60%"><center>
      </td>
      <td style="border: 0px">
        <center>
    <table cellpadding="5%">
        <tr>
          <th>Message</th>
          <th>Content</th>
          <th>Type</th>
        </tr>
        <tr>
          <td>event</td>
          <td>distance, timestamp</td>
          <td>event</td>
        </tr>
   </table>
 </center>
</td>
</tr>
</table>
</div>
<div id="problem_analysis_weight_sensor">
  <h3>Weightsensor</h3>
    <div class="remark">
      Data from <ks>weightsensor</ks> is used when a client starts the <ks>acceptIN</ks> procedure by pressing the <ks>CARENTER</ks> button. Like the sonar,
      the <ks>weightsensor</ks> has to emit events every time the weight measured change significantly (this allows to detect only when
      cars are on the sensor). In this case, events emitted by the <ks>weightsensor</ks> contains the weight measured and the relative timestamp
      in order to guarantee data freshness. <br>
    </div>
      <table cellpadding="20%" style="border: 0px solid transparent;width:98%;" style="width:98%">
        <tr>
          <td style="border: 0px">
              <center><img src="IMG/WEIGHTSENSOR.jpg" alt="WEIGHTSENSOR" width="60%"><center>
          </td>
          <td style="border: 0px">
            <center>
      <table cellpadding="5%">
        <tbody>
          <tr>
            <th>Message</th>
            <th>Content</th>
            <th>Type</th>
          </tr>
          <tr>
            <td>event</td>
            <td>weight, timestamp</td>
            <td>event</td>
          </tr>
        </tbody>
    </table>
  </center>
 </td>
 </tr>
 </table>
</div>
<div id="problem_analysis_thermometer">
  <h3>Thermometer</h3>
  <div class="remark">
    <ks>Thermometer</ks> measures the temperature of the parking room and sends at regular time interval event to the core system. Since temperature doesn't change
    that quickly, the time interval can be quantified in the order of tens of seconds. This help the system to rely in a less bandwidth usage. The time interval
    must take into account of the position of the thermometer in the parking room.
  </div>
  <table cellpadding="20%" style="border: 0px solid transparent;width:98%;" style="width:98%">
    <tr>
      <td style="border: 0px">
          <center><img src="IMG/THERMOMETER.png" alt="THERMOMETER" width="60%"><center>
      </td>
      <td style="border: 0px">
        <center>
  <table cellpadding="5%">
    <tbody>
      <tr>
        <th>Message</th>
        <th>Content</th>
        <th>Type</th>
      </tr>
      <tr>
        <td>event</td>
        <td>temperature, timestamp</td>
        <td>event</td>
      </tr>
    </tbody>
</table>
</center>
</td>
</tr>
</table>
</div>
<div id="problem_analysis_map">
  <h3> Map </h3>
  <div class="remark">
    The <ks>map</ks> is a passive element that is used by the core system to manage the state of the parking-area.
    For a greater simplicity of use the map can be represented by an image composed of different symbols:
    <ul>
      <li>the symbol <b>h</b> represent the "home" position of the trasport trolley;</li>
      <li>the symbol <b>0</b> represents an area where the trasport trolley can move;</li>
      <li>the numbers from <b>1</b> to <b>6</b> represent the parking slots, where the cars can be parked. The specific number is the SLOTNUM used by the core system;</li>
      <li>the symbol <b>|</b> represents a wall;</li>
      <li>he symbol <b>i</b> represents the position of coordinates (6,0), where a car is left by a client;</li>
      <li>the symbol <b>o</b> represents the position of coordinates (6,4), where a car is brought by the trasport trolley to be picked up by the customer.</li>
  </ul>
  <img src="IMG/map.png" alt="MAP" width="20%">
  </div>
</div>
<div id="problem_analysis_GUI_overview">
  <h4>GUI overview</h4>
  <div class="remark">
    In an attempt to achieve a wider catchment area and to guarantee simplicity and portability both GUIs should be web
    interfaces. In that case, <b>Spring</b> is a technology that can be used for the development of the two GUIs .
    Furthermore, both client and manager interfaces should be clear and user-friendly.
  </div>
</div>
<div id="problem_analysis_parking_service_status_GUI">
  <h3>ParkServiceStatusGUI</h3>
  <div class="remark">
    Manager's interface must be able to send commands to the fan and the <ks>trasport trolley</ks> as well as receive and show details
    about current system status. Another key functionality that the manager's interface must integrate is the ability
    to receive and show in a proper way the alarm signal. This requirements can rely on:
    <ul>
      <li><b>request/response</b> mechanism;</li>
      <li><b>polling</b> mechanism;</li>
      <li><b>event</b> mechanism;</li>
    </ul>
    However, the polling mechanism would affect system performance and resources. <br>
    The system behaviour results in two type of interaction between the <ks>ParkServiceStatusGUI</ks> and the core system:
    <ul>
      <li>to stop/resume both fan and trasport trolley with a request/response semantic. This
      allows both entities to know if a command was successful or not;</li>
      <li>to receive data about the current status of the system with an invitation semantic. <!-- This allows to
      reply the system with an ack about the Information received. That mechanism is fundamental
      especially when the alarm is triggered.--></li>
    </ul>
    Below a detailed list of what the GUI must show:
    <ul>
      <li>status of the <ks>fan</ks> (<b>on/off</b>);</li>
      <li>status of the <ks>transport trolley</ks> (<b>idle/working/stopped</b>);</li>
      <li><ks>temperature</ks> of the room (expressed in celsius degrees);</li>
      <li>status of the <ks>INDOOR-area</ks> (through weightsensor data);</li>
      <li>status of the <ks>OUTDOOR-area</ks> (through outsonar data);</li>
    </ul>
    In addiction, the GUI should contain a series of buttons to interact with:
    <ul>
      <li><kr>ACTIVATE</kr>/<kr>DEACTIVATE</kr> button for the fan;</li>
      <li><kr>STOP</kr>/<kr>RESUME</kr> task button for the transport trolley;</li>
      <li><kr>STOP</kr> button if the alarm is triggered;</li>
    </ul>
    The gui must also be able to capture the park manager's attention via visual and additionally audible cues when the alarm is triggered.<br>
  </div>
  <table cellpadding="20%" style="border: 0px solid transparent;width:98%;" style="width:98%">
    <tr>
      <td style="border: 0px">
        <center><img src="IMG/MANAGERGUI.png" alt="ParkingServiceStatusGUI" width="65%"></center>
      </td>
      <td style="border: 0px">
        <center>
          <table cellpadding="5%">
            <tbody>
              <tr>
                <th>Message</th>
                <th>Content</th>
                <th>Type</th>
              </tr>
              <tr>
                <td rowspan="5">Command</td>
                <td>turn_on</td>
                <td rowspan="5">request</td>
              </tr>
              <tr>
                <td>turn_off</td>
              </tr>
              <tr>
                <td>resume_work</td>
              </tr>
              <tr>
                <td>stop_work</td>
              </tr>
              <tr>
                <td>stop_alarm</td>
              </tr>
              <tr>
                <td rowspan="2">Reply</td>
                <td>ok</td>
                <td rowspan="2">reply</td>
              </tr>
              <tr>
                <td>
                  fail
                </td>
              </tr>
              <tr>
                <td>System Status</td>
                <td><a href="#current_state">check above</a></td>
                <td>dispatch</td>
              </tr>
              <tr>
                <td>Alarm</td>
                <td>alarm_situation</td>
                <td>dispatch</td>
              </tr>
            </tbody>
          </table>
        </center>
      </td>
    </tr>
  </table>
</div>
<div id="problem_analysis_parking_service_GUI">
  <h3> ParkServiceGUI </h3>
  <div class="remark">
  Client's interface must be able to send commands to the core system in order to park client's car, receive a
  receipt and to pick up the car using the same receipt. These three phases consist in:
  <ul>
    <li><b>acceptIN</b>: clients manifest their will to park their car. If at least a park slot is available, the system replies with an <ks>SLOTNUM</ks> which identifies the
      park slot using an integer from 0 to 6. This interaction can take place only if the <ks>indoor-area</ks> is free. If <ks>acceptIN</ks> isn't available (<ks>indoor-area<ks> not free) at the moment of the request,
      the client should receive a proper response and a future alert once <ks>acceptIN</ks> command is restored;</li>
    <li><b>CARENTER</b>: once clients leave the car in the indoor-area they press the <ks>CARENTER</ks> button in order to request the parking of their car and
      receive a <ks>TOKENID</ks> (an unique string of value linked to the <ks>SLOTNUM</ks>) as a receipt;</li>
    <li><b>acceptOUT</b>: clients manifest their will to pick up their car by sending their <ks>TOKENID</ks> previously received to the system.
      If the <ks>outdoor-area</ks> is free and the trasport trolley is working, client requests are processed and their car moved from
      the parking slot to the <ks>outdoor-area</ks>. In addition, if the pick up isn't available once requested the system should behave like the <ks>acceptIN</ks> situation
      previously described.</li>
  </ul>
  Another feature that the <ks>ParkServiceGUI</ks> must implement is the capability of receiving an alert if the car stands at the outdoor area for more than <ks>TMAX</ks>.<br>
  Those mechanisms can rely on a request/response communication to send commands. Meanwhile, alerts are a type of information sent by the core system
  which don't require replies.
  </div>
  <table cellpadding="20%" style="border: 0px solid transparent;width:98%;" style="width:98%">
    <tr>
      <td style="border: 0px">
        <center><img src="IMG/PARKSERVICEGUI.png" alt="ParkingServiceGUI" width="65%"></center>
      </td>
      <td style="border: 0px">
        <center>
          <table cellpadding="5%">
            <tbody>
              <tr>
                <th>Message</th>
                <th>Content</th>
                <th>Type</th>
              </tr>
              <tr>
                <td rowspan="3">Command</td>
                <td>acceptIN</td>
                <td rowspan="3">request</td>
              </tr>
              <tr>
                <td>CARENTER</td>
              </tr>
              <tr>
                <td>acceptOUT</td>
              </tr>
              <tr>
                <td rowspan="4">Reply</td>
                <td>ok</td>
                <td rowspan="4">reply</td>
              </tr>
              <tr>
                <td>
                  fail
                </td>
              </tr>
              <tr>
                <td>
                  TOKENID
                </td>
              </tr>
              <tr>
                <td>
                  SLOTNUM
                </td>
              </tr>
              <tr>
                <td rowspan="3">Alert</td>
                <td>free_indoor_area</td>
                <td rowspan="3">dispatch</td>
              </tr>
              <tr>
                <td>
                  pick_up_available
                </td>
              </tr>
              <tr>
                <td>
                  pick_up_needed
                </td>
              </tr>
            </tbody>
          </table>
        </center>
      </td>
    </tr>
  </table>
</div>
<div id="core_system_overview">
  <h4>Core System Overview</h4>
  <div class="remark">
    The core system is the most important component of the entire software system because it contains the business logic.
    Acting like the system 'hub', it manages various types of information coming from external sensors, it receives messages or
    commands from clients or the manager and it controls the transport trolley and the fan.
    For its complexity and by following a 'divide-et-impera' approach and single responsability priciple, the core system could be divided in four different actors:
  </div>
  <center><img src="IMG/CORESYSTEM.png" alt="CoreSystem" width="35%"></center>
  <div class="remark">
    <ul>
      <li><b>business logic actor</b>: process key functionalities for the entire system:
        <ul>
          <li>receive information from the data collector actor;</li>
          <li>manage and maintain parking availability;</li>
          <li>manage transport trolley's state;</li>
          <li>manage automatically the fan or after a manager's command;</li>
          <li>interaction between the manager and clients through the GUI controller actor and the generation and collection of the TOKENID.</li>
        </ul>
      </li>
      <li><b>actuators controller actor</b>: it interacts with components which are able to receive commands. In particular:
        <ul>
          <li>simply redirects commands from the business logic to the fan;</li>
          <li>given initial and final coordinates from the business logic, generates the best path for the transport trolley to follow;</li>
          <li>allows future integration with new active components much easier.</li>
        </ul>
      </li>
      <li><b>data collector actor</b>: it is responsible for receiving and elaborating information from the sensors usable by the business logic actor;</li>
      <li><b>GUI controller actor</b>: it is placed between the business logic actor and GUIs. It gets information from GUIs and forwards them
        to the business logic actor and respectively sends datas from the business logic actor to clients' GUI.</li>
    </ul>
  </div>
</div>
<div id="abstraction_gap">
  <h3>Abstraction gap</h3>
  <div class="remark">
    The problem analysis was carried out to highlight the requirements without focusing on used technologies by introducing high-level concepts.
    Another goal was the development of a code as independent as possible from the technology used for the transport trolley in order to
    make it easier to replace it if necessary. The abstraction between system design and available
    technologies is facilitated thanks to the presence of modern programming languages such as Kotlin that allows the definition of actors. However,
    the use of particular technologies to deal with problems such as data persistence and failure resistance leads to a wider gap.
  </div>
</div>
<div id="system_weakness">
  <h4>System weaknesses</h4>
  <div class="remark">
    The system may soffer some rare case studies:
    <ul>
      <li>If the parking manager isn't well trained about system functionalities he may create a bottleneck of requests simply stopping transport trolley tasks
        through his GUI. In fact, the system isn't developed in a way that can't stop wrong decision by the parking manager;</li>
      <li>Considering the distributed nature of the system, network problems lead to a malfunction of the entire system;</li>
      <li>Some information is kept by the business logic in order to manage the system. In case of system faults, these data can be lost.</li>
    </ul>
  </div>
</div>
<div id="estimate_effort">
  <h3>Estimate delivery time</h3>
  <div class="remark">
    As planned in the problem analysis all sensors and system entities including the core system can be modeled as actors.
    This allows the team to define a first simplified version of the system using QActors. The simplified version of the system is based on a series of assumptions:
    <ul>
      <li>INDOOR cell (6,0) / OUTDOOR cell (6,4);</li>
      <li>temperature under <ks>TMAX</ks>;</li>
      <li>one client;</li>
      <li>no interaction from parking manager;</li>
      <li>one free parking slot (3,3) <ks>SLOTNUM</ks> = 6.</li>
    </ul>
    Following these assumptions the model can be developed in two working days. The first one will be used by a single member of the team to develop the model.
    The first half of the second day will be used by the team to discuss the model produced, meanwhile the second half will be used to fix
    and audit changes proposed previously.
  </div>
</div>
<div id="architectural_model">
  <h3>Logical Architecture</h3>
  <center><img src="IMG/LOGICAL ARCHITECTURE.png" alt="architectural_model" width="40%"></center>
  The model of the system can be seen <a href="https://github.com/enriLoniterp/iss2021project/blob/main/pre-sprint/model/it.unibo.Analysis/src/analisi.qak">here</a>.
  <div class="remark">
    In order to make our parking software reusable and as much as possibile independent from the undelying communication protocols,
    the designer could make reference to proper design pattern such as <b>adapter</b>, <b>bridge</b> and <b>facade</b>. Other design pattern that might be considered during
    the development are <b>singleton</b>, <b>observer</b> and <b>layer</b>.
  </div>
</div>

<h2>Test plans</h2>
<div id="test_plans">
  <div class="remark">
    In this section we discuss and bring attention to the multiple scenarios that might occur during the system viability.
    The object of the tests is to mock some behaviours or concrete situations and then check if the system returns what we expected.<br>

    <b>RELEASE PHASE</b><br>
    During the release-phase of the car test plans must meet these solutions:
    <ol>
    <li>if <U>at least one parking slot is available</U>, <U>INDOOR-AREA is free</U>, <U>the transport-trolley is working</U> and the client makes a parking request,
      it is accepted and the client receives a number between 1 and 6 (linked to the parking slot) as response;</li>
      <li>if <U>all the parking slots are occupied </U>the client receives number 0 as response;</li>
      <li>if <U>the INDOOR-AREA isn't available</U> and <U>the transport trolley is stopped</U> the client receives a waiting message.</li>
    </ol>
    <b>PICK-UP PHASE</b><br>
    During the pick-up phase if <U>the TOKENID is correct</U>, <U>the OUTDOOR-AREA is free</U>, <U>the transport-trolley is working</U> and a client requests
    the pick up of his car the system will provide green light as long as all these three conditions are fulfilled. If this is not the case, then a waiting message
    will appear.
    <br>
    <b>UNCOMMON SITUATIONS</b><br>
    <ol>
      <li>if the the temperature measured by the thermometer is greater than <ks>TMAX</ks>, the <ks>fan</ks> must be activate and the <ks>transport trolley</ks> must be stopped;</li>
      <li>if a car is stuck in the <ks>OUTDOOR-AREA</ks> for more than <ks>TFREE</ks>, the system must send an alarm to the manager.</li>
    </ol>
    These test plans can be found <a href="https://github.com/enriLoniterp/iss2021project/blob/main/pre-sprint/app/src/test/kotlin/pre/sprint/AppTest.kt">here</a>.
  </div>
</div>
<h2>Work Plan</h2>
<div id="work_plan">
  <div class="remark">
    The first product backlog can be defined starting from the previous analysis. The chart contains the following items ordered by priority.<br><br>
    <center>
    <table id="product_backlog" cellpadding="5%">
      <tr>
        <th>ID</th>
        <th>PRIORITY</th>
        <th>ITEM</th>
      </tr>
      <tr>
        <td><b>1</b></td>
        <td>HIGH</td>
        <td>System processes car deposit requests</td>
      </tr>
      <tr>
        <td><b>2</b></td>
        <td>HIGH</td>
        <td>System processes car pick-up requests</td>
      </tr>
      <tr>
        <td><b>3</b></td>
        <td>HIGH</td>
        <td>System manages data from sensors</td>
      </tr>
      <tr>
        <td><b>4</b></td>
        <td>HIGH</td>
        <td>System manages transport trolley</td>
      </tr>
        <td><b>5</b></td>
        <td>MEDIUM</td>
        <td>System satisfies manager's start and stop fan requests</td>
      </tr>
      <tr>
        <td><b>6</b></td>
        <td>MEDIUM</td>
        <td>System satisfies manager's start and stop trolley requests</td>
      </tr>
      <tr>
        <td><b>7</b></td>
        <td>MEDIUM</td>
        <td>System maintains an updated version of the system status</td>
      </tr>
      <tr>
        <td><b>8</b></td>
        <td>MEDIUM</td>
        <td>System recognizes critical OUTDOOR-area situation and generates an alarm for the manager</td>
      </tr>
      <tr>
        <td><b>9</b></td>
        <td>LOW</td>
        <td>System asks the client to pick up his car due a DTFREE timeout</td>
      </tr>
      <tr>
        <td><b>10</b></td>
        <td>LOW</td>
        <td>System manages fan automatically</td>
      </tr>
    </table>
    </center>
    <br>All the items above can be group in several sprint as datailed in the next table:<br><br>
    <center>
    <table id="sprint" cellpadding="5%">
      <tr>
        <th>SPRINT GOAL</th>
        <th>BACKLOG ITEMS</th>
      </tr>
      <tr>
        <td>System basic functionalities</td>
        <td>
          <ul>
            <li>System manages data from sensors.</li>
          </ul>
        </td>
      </tr>
      <tr>
        <td>System basic functionalities</td>
        <td>
          <ul>
            <li>System manages transport trolley.</li>
          </ul>
        </td>
      </tr>
      <tr>
        <td>System able to manage user requests</td>
        <td>
          <ul>
            <li>System processes car deposit requests;</li>
            <li>System processes car pick-up requests.</li>
          </ul>
        </td>
      </tr>
      <tr>
        <td>System interaction with manager and care of system status</td>
        <td>
          <ul>
            <li>System satisfies manager's start and stop fan requests;</li>
            <li>System satisfies manager's start and stop trolley requests;</li>
            <li>System mantains an updated version of the system status;</li>
            <li>System recognizes critical OUTDOOR-area situation and generates an alarm for the manager.</li>
          </ul>
        </td>
      </tr>
      <tr>
        <td>System Optimization</td>
        <td>
          <ul>
            <li>System asks the client to pick up his car due a DTFREE timeout;</li>
            <li>System manages fan automatically.</li>
          </ul>
        </td>
      </tr>
    </table>
  </center>
  </div>
</div>


<h2>Project</h2>

</div>

<h2>Testing</h2>


<h2>Deployment</h2>


<h2>Maintenance</h2>

<!-- USEFUL
<table style="width:100%" border="1">
<tr>
<td style="width:50%">
</td>
<td></td>
</tr>
</table>
-->

<br/><br/>
</div>

<div style="background-color:rgba(86, 56, 253, 0.9); width:60%;text-align:left;color:white">
By studentName email: giuseppe.cristaudo@studio.unibo.it, filippo.manfreda@studio.unibo.it, enrico.andrini@studio.unibo.it
<!--<img src="./img/emiglio.png" alt="mbot" width="15%" height="15%">-->
</div>
</body>
</html>
