<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
    <!--
<link rel="stylesheet" type="text/css" href="../css/issStyle1.css">
<script type="text/javascript" src="../css/issStyle.js"></script>
-->
<style type="text/css">
body
{
    margin-left:  30px;
    margin-right: 30px;
};

P
{
    font-family: Tahoma;
    font-size: 10pt;
};

a, a:visited, a:active, a:link, a:hover {
    text-decoration: underline;
    color: #545454;
    background-color: transparent;
	font-size: 93%;
}

a:hover {
    background-color: #cccccc;
}


hr {
    clear: both;
    height: 1px;
    color: #242424;
    background-color: transparent;
}

h1, h2, h3 {
    color: #242424;
    clear: left;
    font: 100% Tahoma, Helvetica, Arial, sans-serif;
    margin-bottom: 0.5em;
    padding-top: 0.5em;
	border-radius: 10px;
	padding: 5px;
}

top {
	width: 100%;
}


#i {
    color: #ff1010;
}
tt{
	font-family: "Arial";
    font-size: 90%;
	color: #006600;
}
em{
	font-family: "Arial";
    font-size: 80%;
	font-weight: bold;
	border-style:solid;
	border-color: #abe876;
    color: #1632cc;
}
bc{
	font-family: "Arial";
	font-size: 90%;
	font-weight: bold;
    color: #990000;
	background-color: #fcf8c7;
}
ks{
	font-family: "Arial";
	font-weight: bold;
    color: #0000CD	;
	font-size: 90%;
}
kc{
	font-family: "Arial";
	font-weight: bold;
    color: #008000	;
	font-size: 90%;
}
kr{
	font-family: "Arial";
	font-weight: bold;
    color: #ff0000	;
	font-size: 90%;
}
pre{
	font-family: "Consolas";
	font-size: 85%;
	background-color: #f5f5f5;
	border: 1.5px solid silver;
	padding: 5px;
}
m{
	font-family: "Helvetica";
	line-height: 100%;
 	font-size: 75%;
}
div.body{

    font-size: 18px;
}
k{
    color: #990000;
	font-weight: bold;
	font-size: 90%;
}
h1 {
    font-size: 150%;
    background-color: #b2c0ff;
	padding: 10px;
}

h2 {
    background-color: #9ed8ff;
    font-size: 130%;
}

h3 {
	background-color: #e6ccff;
    font-size: 100%;
}
h4 {
    background-color: #ccffcc;
    font-size: 100%;
	width: 100%;
	border-radius: 5px;
	padding: 2px;
}
h5 {
    background-color: #d5ffb0;
    font-size: 100%;

}
div.req{
	background-color: #d9ffb3;
    font-size: 18px;
	width: 700px;
    border: 3px solid green;
    padding: 15px;
    margin: 10px;
}
div.remark{
	background-color: #E3F2FD;
    border: 1.5px solid #d5f2ed;
    padding: 15px;
    margin: 10px;
	border-radius: 25px;
}
table, th, td {
  border: 1px solid black;
  border-collapse: collapse;
}

#exampleclass tbody,
#exampleclass thead,
#exampleclass th {
  border: 0;
}

ol, ul, li {
  margin: 0;
  margin-left: 10px;
  padding: 0;
  padding-bottom: 5px;
}

table, th, td {
	border: 1px solid black;
}

img {
	border: 1.5px solid #d5f2ed

}

a, a:visited, a:active, a:link, a:hover {
    text-decoration: underline;
    color: #545454;
    background-color: transparent;
}

div.wrapdesc{
	width: 90%;
	margin: auto;
}

div.imagedesc{
	width: 85%;
	margin: auto;
}
</style>

<head>

<title>Final task ISS-2021 Bologna: Automated Car-Parking - Sprint 3</title></head>

<body>
<div id="top">
<h1>Final task ISS-2021 Bologna: Automated Car-Parking - Sprint 3<font size="5"></font> </h1>
</div>

<div class="body">
<div id = "backlog">
  <h2>Sprint 3 Backlog</h2>
  <div class="remark">
    Sprint 2 regards the develop of the <ks>PMS</ks> able to manage user requests:
    <ul>
      <li><ks>PMS</ks> processes car deposit requests:
        <a href="../../requirements/userDocs/Automated Car-Parking.html#R1" target = "_blank">R1</a>,
        <a href="../../requirements/userDocs/Automated Car-Parking.html#R2" target = "_blank">R2</a>,
        <a href="../../requirements/userDocs/Automated Car-Parking.html#R2B" target = "_blank">R2B</a>;
      <li><ks>PMS</ks> processes car pick-up requests:
        <a href="../../requirements/userDocs/Automated Car-Parking.html#R3" target = "_blank">R3</a>.</li>
    </ul>
  </div>
</div>
<h4>Starting point</h4>
<center><img src="IMG/StartingPoint.jpg" alt="starting_point_sprint" width="40%"></center>


<div id = "problem_analysis">
<h2>Problem analysis</h2>
<div class="remark">
  This Sprint aim is to develop and deeper describe the following entities:
  <ul>
    <li><ks>Park Manager Service</ks>;</li>
    <li><ks>ParkServiceGUI</ks>;</li>
  </ul>
</div>
<div class = "remark">
  An initial model of these entities, without interaction between them, can be found <a href = "../model1/model1.qak" target = "_blank">here</a>.<br>
</div>
  <h3>PMS</h3>
  <div class = "remark" id="problem_analysis_PMS">
    From the <a href="#backlog">backlog</a>, the <ks>PMS</ks> needs to processes car deposit and pick-up requests. <br>
    Following the <b>single-responsability principle</b>, the introduction of a new entity would allow the <ks>PMS</ks> to perform these tasks without interferring
    with the rest of the application. In addition, this entity should comunicate with the <a>TrolleyController</a> developed in the previous sprint. <br>
    Regarding the interaction with the client, it is necessary to generate an unique receipt (<kr>TOKENID</kr>) every time a client request a deposit.
    As per requirements, the TOKENID should be representative of the SLOTNUM assigned to the parked car to allow the PMS recognize
    the SLOTNUM where the car is parked. A possible way to generate an unique TOKENID can consider using the current date and time. Another possibility is to concatenate
    the SLOTNUM to a random string long enough. Another necessity is the managment of the parking status using a specific datastructure.
    In case of system crashes, storing the parking status in a file make the system robust.<br>
    The entity should be also reliable in case of a high number of request.
  </div>
</div>
The Sprint 3 should be done in <b>four days</b>.
<div id = "project">
<h2>Project</h2>
Starting from the <a href="../../requirements/userDocs/Automated%20Car-Parking.html#architectural_model" target = "_blank">logical architecture</a>
and from the <a href="#backlog">product backlog</a> we can now and design the <ks>transport trolley</ks>, its managment and the <ks>fan</ks>.<br>
We maintain the <b>hexagonal architecture</b>, introduced in the previous sprint, developing port and adapter. This allows to keep separate the
technology independent part from the technology dependent one.
<h4>Specifications common to all actuators</h4>
<table cellpadding="5%">
  <tbody><tr>
    <td style="width: 50%; vertical-align:top">
        As we developed for the sensors, we decided to use a <b>single interface</b>
        (<a href="../src/main/ActuatorPort.kt" target="_blank">ActuatorPort.kt</a>)
        for all adapters and a <b>factory class</b> (<a href="../src/main/ActuatorFactory.kt" target="_blank">ActuatorFactory.kt</a>)
        to allow the business logic to obtain the right instance of the adapter for a given type of actuator (<a href="../src/main/ActuatorType.kt" target="_blank">ActuatorType.kt</a>).
    </td>
    <td>
      <center>
        <img src="IMG/ActuatorFactory.jpg" alt="actuator_factory" width="60%">
      </center>
    </td>
  </tr>
</tbody></table>
<h4>Technology independent</h4>
<table cellpadding="5%">
  <tr>
    <td style="width: 50%; vertical-align:top">
      <h4><a href = "../src/it/unibo/trolley_controller/Trolley_controller.kt" target = "_blank">TrolleyController</a></h4>
      As said in the analysis phase, we introduce a new entity <a href = "../src/it/unibo/trolley_controller/Trolley_controller.kt" target = "_blank">TrolleyController</a> which takes care
      of maintaining the current state of the <ks>transport trolley</ks> (<b>idle</b> / <b>working</b> / <b>stopped</b>) and manages the interaction with it, allowing the rest of the <ks>PMS</ks> to
      carry out other activities. Given the state nature of this entity, it is modeled as FSM actor (<a href="https://htmlpreview.github.io/?https://github.com/anatali/issLab2021/blob/master/it.unibo.qakactor/userDocs/LabQakIntro2021.html" target = "_blank">Qakactor</a>).<br>
      To solve the problem indicated in the analysis phase relating to the stop of the transport trolley, a variable (<b>currentTask</b>) has been introduced that
      takes on different values ​​relating to the task it was carring out before being stopped.<br>
      On the right, it is displayed the state diagram of the actor and a table with the values and meanings of the currentTask variable.
    </td>
    <td>
      <center>
        <img src="IMG/transport_trolley_FSM.jpg" alt="transport_trolley_FSM" width="100%">
      </center>
      <br>
      <table cellpadding="5%" width="100%">
        <tr>
          <th>currentTask</th>
          <th>meaning</th>
        </tr>
        <tr>
          <td><center>IDLE</center></td>
          <td>Transport trolley isn't working and it is waiting for a request</td>
        </tr>
        <tr>
          <td><center>HOME</center></td>
          <td>Transport trolley has just come back to HOME position</td>
        </tr>
        <tr>
          <td><center>INDOOR</center></td>
          <td>Transport trolley has just arrived in the INDOOR area</td>
        </tr>
        <tr>
          <td><center>OUTDOOR</center></td>
          <td>Transport trolley has just arrived in the OUTDOOR area</td>
        </tr>
        <tr>
          <td><center>PARKIN</center></td>
          <td>Transport trolley has just parked a car in a parking slot</td>
        </tr>
        <tr>
          <td><center>PARKOUT</center></td>
          <td>Transport trolley has just picked up a car from a parking slot</td>
        </tr>
      </table>
    </td>
  </tr>
  <tr>
    <td>
      <h4><a href = "../src/itunibo/planner/plannerUtil.kt" target = "_blank">PlannerUtil</a></h4>
      As pointed out in the problem analiys, we can use <ks>plannerUtil</ks> to generate the path for the <ks>transport trolley</ks>. This framework helps us
      to simplify the process of developing each task for the transport trolley. Infact, thanks to it, the business logic only has to define the goal
      coordinates (a pair of integer which uniquely identify a cell in the parking room) and the planner, thanks to the aima framework, return a list
      of moves which represents the path that the <ks>transport trolley</ks> has to follow. In our case parking slots are considered obstacle in the parking room and
      for that reason are market with "<b>X</b>" as stated in the <a href="https://htmlpreview.github.io/?https://github.com/anatali/issLab2021/blob/master/it.unibo.cautiousExplorer/userDocs/LabPlanner2021.html#plannerUtil" target = "_blank">plannerUtil documents</a>.<br>
      In addiction, <ks>plannerUtil</ks> has a method which allows to update the position of the transport trolley after every successfull move.<br>
      We decided to add a method in the <ks><a href = "../src/itunibo/planner/plannerUtil.kt" target = "_blank">plannerUtil</a></ks> (loadRoomMapFromTxt(file: String)) which allow the system to load the parking map from a txt file.
      In case of failure during the path, the <ks>transport trolley</ks> should return to <b>HOME</b> position and a new path should be generated starting from (0, 0).
    </td>
    <td>
      <center>
        <img src="IMG/plannerUtil.jpg" alt="plannerUtil_diagram_class" width="100%">
      </center>
    </td>
  </tr>
  <tr>
    <td width="50%">
      <h4>Communication with transport trolley</h4>
      Following the hexagonal architecture, an adapter and a port have been developed. This components are used by the <ks>trolleyController</ks>
      to communicate with the <ks>transport trolley</ks>. Both <b>CoAP</b> and <b>MQTT</b> are good protocols for IoT devices, but MQTT is more oriented on a publish-subscribe
      logic while in this case we don't need that kind of interaction and CoAP is a restful protocol good for M2M interaction. <br>
      Since the <ks>TrolleyController</ks> is an actor it allows other antities to register with it as observers by making its internal state available
    </td>
    <td>
      <center>
        <img src="IMG/trolleyAdapter.jpg" alt="trolley_adapter" width="90%">
      </center>
    </td>
  </tr>
  <tr>
    <td width="50%">
      <h4>Communication with fan</h4>
      We developed the communication with the <ks>fan</ks> in the same way as we did for the <ks>transport trolley</ks>.
    </td>
    <td>
      <center>
        <img src="IMG/fanAdapter.jpg" alt="fan_adapter" width="90%">
      </center>
    </td>
  </tr>
</table>
<h4>Technology dependent</h4>
<table>
  <tr>
    <td style="width: 50%; vertical-align:top">
      <h4><a href = "../src/it/unibo/" target = "_blank">Transport trolley</a></h4>
      The development of the technology dependent part of the <ks>transport trolley</ks> was facilitated thanks to what the customer made available.
      In fact, the code presented in <a href = "https://github.com/anatali/issLab2021/blob/main/it.unibo.qak21.basicrobot/" target = "_blank">it.unibo.qak21.basicrobot</a> was modified in some parts and used, which allows to use the real <b>DDR robot</b> used in our project.
      Changes made to the code regards movement time of the robot action due to specific movement speed of our robot. <br>
      All details relating to this entity can be found in <a href = "https://htmlpreview.github.io/?https://github.com/anatali/issLab2021/blob/main/it.unibo.qak21.basicrobot/userDocs/basicrobot2021.html" target = "_blank">basicrobot2021.html</a>. Thanks to this code it is possible, after configuration,
      to use a virtual environment in case a real robot is not available.

    </td>
  </tr>
  <tr>
    <td style="width: 50%; vertical-align:top">
      <h4><a href = "../src/it/unibo/fan/Fan.kt" target = "_blank">Fan</a></h4>
      As stated in the requirements, we design the fan as a <b>mock actor</b>. We choose the actor, over the object, as it is possible to observe its status at any time.
    </td>
  </tr>
</table>
</div>


<h2>Testing</h2>
<div class="remark">
Since Sprint 2 is focused on the transport trolley, test plans will be carry out testing the "MACRO" moves priovously described (R2A, R2C/R3B, R2D/R2E/R3D, R3C),
without taking care on particular situation where the transport trolley can't start its task (R1/R3). These situation will be included in future sprints.
In addiction, in order to test <ks>trolleyController</ks> functionalities, we decided to run all the following tests using the real robot. <br>
For that reason, we assumed the following starting assumptions:
<ul>
  <li>INDOOR and OUTDOOR AREA are not engaged;</li>
  <li>FAN status off;</li>
  <li>No Magager interaction;</li>
  <li>Transport trolley starts from home location;</li>
  <li>All parking slots are free.</li>
</ul>
Hereafter is a description of the functional tests for this sprint:
<pre>
  <a>TEST #1 - no queue task</a>
  creation of an istance of <b>adapter</b>
  robot -> <ks>moveToSlot(1)</ks>
  <!--check if coordinates(<b>robot</b>) == coordinates(1,1)-->
  no task in queue
  <!-- robot -> <ks>moveToHome</ks> -->
  check if coordinates(<b>robot</b>) == coordinates(<b>HOME</b>)
</pre>
<pre>
  <a>TEST #2 - complete cycle of tasks</a>
  creation of an istance of <b>adapter</b>
  robot -> <ks>moveToIn</ks>
  check if coordinates(<b>robot</b>) == coordinates(<b>INDOOR AREA</b>)
  robot -> <ks>moveToSlotIn(3)</ks>
  check if coordinates(<b>robot</b>) == coordinates(1,3)
  robot -> <ks>moveToSlotOut(3)</ks>
  check if coordinates(<b>robot</b>) == coordinates(1,3)
  robot -> <ks>moveToOut</ks>
  check if coordinates(<b>robot</b>) == coordinates(<b>OUTDOOR AREA</b>)
  robot -> <ks>moveToHome</ks>
  check if coordinates(<b>robot</b>) == coordinates(<b>HOME</b>)
</pre>
<pre>
  <a>TEST #3 - halt functionality</a>
  creation of an istance of <b>adapter</b>
  robot -> <ks>moveToSlotIn(1)</ks>
  robot -> <ks>stop</ks>
  check if coordinates(<b>robot</b>) == coordinates(1,1)
  no task in queue
  robot -> <ks>resume</ks>
  <!-- robot -> <ks>moveToHome</ks> -->
  check if coordinates(<b>robot</b>) == coordinates(<b>HOME</b>)
</pre>
Fan test is as follow:
<pre>
  status(fan) == OFF
  fan -> <ks>ON</ks>
  check if status(fan) == ON

  fan -> <ks>OFF</ks>
  check if status(fan) == OFF
</pre>
</div>

<h4>Summary point</h4>
<center><img src="IMG/summaryPoint.jpg" alt="summary_point" width="50%"></center>
<h2>Deployment</h2>
<div class="remark">
  In this Sprint we deployed the code of the real robot (<a>basicRobot</a>) changed as stated in the project phase. It has been deployed
  using gradle distZip command. The result of the deployment is a zip file <em>basicRobot.zip</em> that contains a bin directory with the executables.
</div>

<h2>Job task</h2>
<table cellpadding="5%">
  <tr>
    <th>Member</th>
    <th>Task done</th>
  </tr>
  <tr>
    <td><center><b>Manfreda Filippo</b><br>filippo.manfreda@studio.unibo.it</center></td>
    <td>
      <ul>
        <li>DDR Robot</li>
      </ul>
    </td>
  </tr>
  <tr>
    <td><center><b>Team</b></center></td>
    <td>
      <ul>
        <li>Problem analysis;</li>
        <li>Transport trolley;</li>
        <li>Fan;</li>
        <li>Testing;</li>
        <li>Deployment</li>
      </ul>
    </td>
  </tr>
</table>
<h2>Sprint Review</h2>
<div class="remark">
</div>
<h2>Maintenance</h2>

<!-- USEFUL
<table style="width:100%" border="1">
<tr>
<td style="width:50%">
</td>
<td></td>
</tr>
</table>
-->

<br/><br/>
</div>

<div style="background-color:rgba(86, 56, 253, 0.9); width:60%;text-align:left;color:white">
By Cristaudo Giuseppe, Manfreda Filippo, Andrini Enrico; email: giuseppe.cristaudo@studio.unibo.it, filippo.manfreda@studio.unibo.it, enrico.andrini2@studio.unibo.it
<!--<img src="./img/emiglio.png" alt="mbot" width="15%" height="15%">-->
</div>
</body>
</html>
