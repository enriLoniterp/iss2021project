<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
    <!--
<link rel="stylesheet" type="text/css" href="../css/issStyle1.css">
<script type="text/javascript" src="../css/issStyle.js"></script>
-->
<style type="text/css">
body
{
    margin-left:  30px;
    margin-right: 30px;
};

P
{
    font-family: Tahoma;
    font-size: 10pt;
};

a, a:visited, a:active, a:link, a:hover {
    text-decoration: underline;
    color: #545454;
    background-color: transparent;
	font-size: 93%;
}

a:hover {
    background-color: #cccccc;
}


hr {
    clear: both;
    height: 1px;
    color: #242424;
    background-color: transparent;
}

h1, h2, h3 {
    color: #242424;
    clear: left;
    font: 100% Tahoma, Helvetica, Arial, sans-serif;
    margin-bottom: 0.5em;
    padding-top: 0.5em;
	border-radius: 10px;
	padding: 5px;
}

top {
	width: 100%;
}


#i {
    color: #ff1010;
}
tt{
	font-family: "Arial";
    font-size: 90%;
	color: #006600;
}
em{
	font-family: "Arial";
    font-size: 80%;
	font-weight: bold;
	border-style:solid;
	border-color: #abe876;
    color: #1632cc;
}
bc{
	font-family: "Arial";
	font-size: 90%;
	font-weight: bold;
    color: #990000;
	background-color: #fcf8c7;
}
ks{
	font-family: "Arial";
	font-weight: bold;
    color: #0000CD	;
	font-size: 90%;
}
kc{
	font-family: "Arial";
	font-weight: bold;
    color: #008000	;
	font-size: 90%;
}
kr{
	font-family: "Arial";
	font-weight: bold;
    color: #ff0000	;
	font-size: 90%;
}
pre{
	font-family: "Consolas";
	font-size: 85%;
	background-color: #f5f5f5;
	border: 1.5px solid silver;
	padding: 5px;
}
m{
	font-family: "Helvetica";
	line-height: 100%;
 	font-size: 75%;
}
div.body{

    font-size: 18px;
}
k{
    color: #990000;
	font-weight: bold;
	font-size: 90%;
}
h1 {
    font-size: 150%;
    background-color: #b2c0ff;
	padding: 10px;
}

h2 {
    background-color: #9ed8ff;
    font-size: 130%;
}

h3 {
	background-color: #e6ccff;
    font-size: 100%;
}
h4 {
    background-color: #ccffcc;
    font-size: 100%;
	width: 95%;
	border-radius: 5px;
	padding: 2px;
}
h5 {
    background-color: #d5ffb0;
    font-size: 100%;

}
div.req{
	background-color: #d9ffb3;
    font-size: 18px;
	width: 700px;
    border: 3px solid green;
    padding: 15px;
    margin: 10px;
}
div.remark{
	background-color: #E3F2FD;
    border: 1.5px solid #d5f2ed;
    padding: 15px;
    margin: 10px;
	border-radius: 25px;
}
table, th, td {
  border: 1px solid black;
  border-collapse: collapse;
}

#exampleclass tbody,
#exampleclass thead,
#exampleclass th {
  border: 0;
}

ol, ul, li {
  margin: 0;
  margin-left: 10px;
  padding: 0;
  padding-bottom: 5px;
}

table, th, td {
	border: 1px solid black;
}

img {
	border: 1.5px solid #d5f2ed

}

a, a:visited, a:active, a:link, a:hover {
    text-decoration: underline;
    color: #545454;
    background-color: transparent;
}

div.wrapdesc{
	width: 90%;
	margin: auto;
}

div.imagedesc{
	width: 85%;
	margin: auto;
}
</style>

<head>

<title>Final task ISS-2021 Bologna: Automated Car-Parking</title></head>

<body>
<div id="top">
<h1>Final task ISS-2021 Bologna: Automated Car-Parking<font size="5"></font> </h1>
</div>

<div class="body">


<h2>Introduction</h2>
<div id="Introduction">
  This document deals with the design, build and development of a software system, named <ks>ParkingManagerService</ks>,
  which implements a series of functions to manage an automating parking service.
</div>
<h2>Requirements</h2>
<div id="Requirements" class="remark">
  The <kr>ParkManagerService</kr> should create the <kr>ParkServiceGUI</kr> (for the client) and the <kr>ParkServiceStatusGUI</kr> (for the manager)
  and then perform the following tasks:
  <ul>
    <li><ks><a id="R1">(R1)</a> acceptIN</ks>: accept the request of a client to park the car if there is at least one <kr>parking-slot</kr> available,
      select a free slot identified with a unique <kr>SLOTNUM</kr>.
      A request of this type can be elaborated only when the <kr>INDOOR-area</kr> is free, and the <kr>transport trolley</kr> is at <kr>home</kr> or working
      (not stopped by the manager). If the <kr>INDOOR-area</kr> is already engaged by a car, the request is not immediately processed (the client could simply
      wait or could - optionally - receive a proper notice).</li>
    <li><ks><a id="R2">(R2)</a> informIN</ks>: inform the client about the value of the <kr>SLOTNUM</kr>.</li>
    </ul>
    If <b>SLOTNUM</b> > 0:
    <ol>
      <li><ks><a id="R2A">(R2A)</a> moveToIn</ks>: move the <kr>transport trolley</kr> from its current localtion to the <kr>INDOOR</kr>;</li>
      <li><ks><a id="R2B">(R2B)</a> receipt</ks>: send to the client a receipt including the value of the <kr>TOKENID</kr>;</li>
      <li><ks><a id="R2C">(R2C)</a> moveToSlotIn</ks>: move the <kr>transport trolley</kr> from the <kr>INDOOR</kr> to the selected <kr>parking-slot</kr>;</li>
      <li><ks><a id="R2D">(R2D)</a> backToHome</ks>: if no other request is present, move the <kr>transport trolley</kr> to its <kr>home</kr> location, else <ks>acceptIN</ks> or <ks>acceptOUT</ks>.</li>
    </ol>
    If <b>SLOTNUM</b> == 0:
    <ul>
      <li><ks><a id="R2E">(R2E)</a> moveToHome</ks>: if not already at home, move the <kr>transport trolley</kr> to its <kr>home</kr> location.</li>
    </ul>
    <hr size="4" color="black">
    <ul>
      <li><ks><a id="R3">(R3)</a> acceptOUT</ks>: accept the request of a client to get out the car with <kr>TOKENID</kr>. A request of this type can be
        elaborated only when the <kr>OUTDOOR-area</kr> is free and the <kr>transport trolley</kr> is at <kr>home</kr> or working (<b>not stopped</b> by the manager).
        If the <kr>OUTDOOR-area</kr> is still engaged by a car, the request is not immediately processed (the client could simply wait or could -
        optionally - receive a proper notice).</li>
    </ul>
    <ol>
      <li><ks><a id="R3A">(R3A)</a> findSlot</ks>: deduce the number of the parking slot (<ks>CARSLOTNUM</ks>) from the <kr>TOKENID</kr>;</li>
      <li><ks><a id="R3B">(R3B)</a> moveToSlotOut</ks>: move the <kr>transport trolley</kr> from its current localtion to the <kr>CARSLOTNUM</kr>/<kr>parking-slot</kr>;</li>
      <li><ks><a id="R3C">(R3C)</a> moveToOut</ks>: move the <kr>transport trolley</kr> to the <kr>OUTDOOR</kr>;</li>
      <li><ks><a id="R3D">(R3D)</a> moveToHome</ks>: if no other request is present move the <kr>transport trolley</kr> to its <kr>home</kr> location;<br>
        else <ks>acceptIN</ks> or <ks>acceptOUT</ks>
    </ol>
    <hr size="4" color="black">
    <ul>
      <li><ks><a id="R4">(R4)</a> monitor</ks>: update the <kr>ParkServiceStatusGUI</kr> with the required information about the state of the system.</li>
    </ul>
    <hr size="4" color="black">
    <ul>
      <li><ks><a id="R5">(R5)</a> manage</ks>: accept the request of the manager to stop/resume the behavior of the <kr>transport trolley</kr>.</li>
    </ul>
  <br>
  A detailed description of the requirements is available <a href="TFBO21ISS.pdf">here</a>
</div>

<h2>Requirement analysis</h2>
<div class="remark">
  <div>
    Our <b>interaction with the customer</b> has clarified that nouns have the following meanings:
    <ul>
      <li><ks>service</ks>: system of intercommunicating components based on a combination of hardware and software which handles interaction between human and machine;</li>
      <li><ks>automation functions</ks>: set of functions or tasks which <kr>ParkingManagerService</kr> runs without any kind of employee's interaction or supervision;</li>
      <li><ks>DDR Robot</ks>: physical or virtual (simulated in an virtual environment) object which can be represented and controlled using the infomation in <a href="./basicrobot2021.html">basicrobot2021</a>;</li>
      <li><ks>transport trolley</ks>: component which uses the <ks>DDR Robot</ks> in order to complete his tasks;</li>
      <li><ks>home</ks>: shelter or starting point located in the parking area;</li>
      <li><ks>weight sensor</ks>: weight transducer which converts an input mechanical force such as load, weight,
                                 tension, compression, or pressure into another physical variable, in this case,
                                 into an electrical output signal that can be measured and converted. <br>
                                 Since the system interacts with cars, the weight sensor triggers only when a
                                 sufficient weight is placed on the footplate;</li>
      <li><ks>outsonar</ks>: physical tool capable to detect object that cross its trajectory. The customers gave access to <a href="./SonarAlone.c">SonarAlone.c</a> which allows to manage the sonar;</li>
      <li><ks>parking-area</ks>: area provided for the parking of vehicles and includes any parking spaces, ingress and egress lanes.</li>
      <li><ks>empty room</ks>: section of a building which is enclosed by walls and a floor. The room also does not contain
                              anything. It isn't filled or occupied by any physical object;</li>
      <li><ks>INDOOR</ks>: fixed point of the map which marks where car can enter the parking;</li>
      <li><ks>OUTDOOR</ks>: fixed point of the map which marks where car can exit the parking;</li>
      <li><ks>INDOOR-area</ks>: detailed area of the map where the weight sensor is placed;</li>
      <li><ks>OUTDOOR-area</ks>: detailed area of the map where the out sonar is placed;</li>
      <li><ks>weight</ks>: body(car)'s relative mass or the quantity of matter contained by it;</li>
      <li><ks>parking-slots</ks>: six fixed place in a specific area of the map where car are or can be parked;</li>
      <li><ks>thermometer</ks>: sensor which is situated inside the parking and able to measuring and indicating temperature;</li>
      <li><ks>fan</ks>: actuator for producing a current of air by the movement of a broad surface or a number of such surfaces;</li>
      <li><ks>map</ks>: representation of the environment that delineates <ks>home</ks>, <ks>INDOOR</ks>, <ks>OUTDOOR</ks> and <ks>parking area</ks> defined in <a href="./parkingMap.txt">parkingMap.txt</a>.
      <li><ks>fixed obstacles</ks>: walls which marks the limit of the <ks>room</ks>;</li>
      <li><ks>WEnv</ks>: virtual environment which simulate the scene of the parking in order to simplify the development in a real context. The <ks>WEnv</ks> configuration is reported in <a href="./parkingAreaConfig.js">parkingAreaConfig.js</a>;</li>
      <li><ks>critical situations</ks>: anomalous situations not foreseen in advance and managed in a general way;</li>
      <li><ks>TOKENID</ks>: string which identify in an unique way cars parked in the system and which is used in the car pick up phase;</li>
      <li><ks>ParkServiceGUI</ks>: user interface which allows users to interact with the parking system and which shows the <ks>SLOTNUM</ks> and <ks>TOKENID</ks>
                                  and buttons  which help the user to park and retrieve their car;</li>
      <li><ks>ParkServiceStatusGUI</ks>: user interface which allows manager to interact with the parking system
                                        and which shows the <ks>current state</ks> of the parking area;
      <li><ks>SLOTNUM</ks>: integer that represents <ks>parking-slots</ks>;</li>
      <li><ks>current state</ks>: current situation of the entire system. It includes <ks>parking-slots</ks> availability,
                                 room <ks>temperature</ks>, state of the <ks>fan</ks> and state of the <ks>ParkingServiceGUI</ks>;</li>
      <li><ks>behaviour</ks>: status of <ks>transport trolley</ks>:
                            <ul>
                              <li><kr>Idle</kr>: has no duties to perform;</li>
                              <li><kr>Working</kr>: currently performing tasks;</li>
                              <li><kr>Stop</kr>: state driven manually by the manager or in an automatic mechanism when <ks>TA</ks> > <ks>TMAX</ks>;</li>
                            </ul>
      </li>
      <li><ks>alarm</ks>: signal which warn the manager of the system through the <ks>ParkServiceStatusGUI</ks>
                         when the <ks>OUTDOOR-area</ks> has not been cleaned within the <ks>DTFREE</ks> interval of time;</li>
      <li><ks>proper notice</ks>: warning sent to the user through the <ks>ParkServiceGUI</ks> if the <ks>INDOOR-area</ks> is already
                                engaged by a car;</li>
    </ul>
  </div>
  <div>
    Regarding action or verbs:
    <ul>
      <li><ks>equipped</ks>: the system is supplied with the necessary items for a particular purpose;</li>
      <li><ks>notify/inform</ks>: the interaction between the software system and the user and vice versa;</li>
      <li><ks>walk</ks>: the <ks>transport trolley</ks> moves in order to complete its task;</li>
      <li><ks>take over</ks>: the <ks>transport trolley</ks> picks up a car and carries it inside the parking;</li>
      <li><ks>observe</ks>: the <kr>ParkingManager</kr> monitors the <ks>current state</ks> of the system;</li>
      <li><ks>clean</ks>: the <ks>OUTDOOR-area</ks> is free;</li>
    </ul>
  </div>
</div>
<br>
<div class="remark">
  After a discussion with the customer the <ks>out-sonar</ks>, the <ks>thermometer</ks> and the <ks>weightsensor</ks> are an autonmous active component that does not 'know' any other component.
</div>
<div class="remark">
  The two actuators (<ks>transport trolley</ks> and <ks>fan</ks>), following the discussion with the customer and as they are actively controlled by the ParkManagerService,
  can already be modeled as actors using the Qak meta-modeling language. <!-- Questo modello di linguaggio di modellazione è un custom dsl sviluppate dal committente
  e possono essere ritrovate nella seguente libreria. -->
  <br>
  The model of the two actors is detailed <a href="https://github.com/enriLoniterp/iss2021project/blob/main/requirements/model_req_an/src/requirements.qak">here</a>.
  In addiction, unit test for both the <a href="https://github.com/enriLoniterp/iss2021project/blob/main/requirements/model_req_an/src/tests/TestPlanFan.kt">fan</a>
  and the <a href="https://github.com/enriLoniterp/iss2021project/blob/main/requirements/model_req_an/src/tests/TestPlanTrolley.kt">trasport trolley</a> are presented.
</div>

<!--
<div id="user_stories">
  <div id="Main User Story">
    <h3>Main user story</h3>
    <table style="width:98%" cellpadding="5%">
      <tbody>
        <tr>
          <td style="width:70%">
           A client interacts with the <ks>ParkServiceGUI</ks> in order to park its car. The system, then checks if the <ks>INDOOR-area</ks> is free, and in that case
           it replies to the client with a number that identifies a free park-slot (<ks>SLOTNUM</ks>). At that time, if <ks>SLOTNUM</ks> > 0, the client receives a receipt with the
           <ks>TOKENID</ks>, enters the car and then the <ks>ParkingManagerService</ks> makes the transport trolley pick up the car <b>(1)</b> and moves it to the selected parking-slot <b>(2)</b>. <br><br>
           When the client wants his car back, he interacts again with the <ks>ParkServiceGUI</ks> by requesting a pick up of his car
           using the <ks>TOKENID</ks> previously received. At this time, the transport trolley carries the selected car from its parking-slot to the
           outdoor-area <b>(3)</b>. Finally, the client takes the car and frees the outdoor-area.
          </td>
          <td><center><img src="IMG/user_story_1.jpg" alt="TestPlan0" width="95%"></center>
          </td>
        </tr>
       </tbody>
    </table>
    <pre> Let assume the <ks>INDOOR-area</ks> is free and at least one parking slot is available:<br>
          Client notifies interest in entering the car<br>
          System return <ks>SLOTNUM</ks><br>
          assert 0 < <ks>SLOTNUM</ks> <= 6<br>
          Client <ks>CARENTER</ks><br>
          System return <ks>TOKENID</ks> and park the car<br>
          <b>wait</b><br>
          Client wants to pick up his car by sending <ks>TOKENID</ks><br>
          System moves the selected car to the <ks>OUTDOOR-area</ks><br>
          Client receives a confirm.
    </pre>
  </div>
<div id="user_story_standard_supervision">
  <h3>User story: normal parking manager's supervision</h3>
  <table style="width:98%" cellpadding="5%">
    <tbody>
      <td>
        While the <kr>ParkingMenagerService</kr> is working, it collects data of system current state. This includes the temperature (<ks>TA</ks>), state of the fan
        and the <ks>transport trolley</ks>. The manager can view this information by the GUI.
      </td>
    </tbody>
  </table>
</div>
<pre>
  System simulates the change of the current status<br>
  GUI checks if new changes appears.
</pre>
<div id="user_story_non_standard_supervision">
  <h3>User story: non standard parking manager's supervision</h3>
  <table style="width:98%" cellpadding="5%">
    <tbody>
      <td>
        When the system is working, the thermometer measures the temperature <ks>TA</ks>. If <ks>TA</ks> > <ks>TMAX</ks> the <kr>ParkingManagerService</kr> informs the <ks>ParkingServiceStatusGUI</ks>.
        Therefore the manager requests to stop the trasport trolley and activates the fan via the GUI.
        The system stops the <ks>transport trolley</ks> and waits until <ks>TA</ks> < <ks>TMAX</ks>. When this happens the manager sees it on the GUI and requests to activate the
        <ks>trasport</ks> trolley and to stop the fan using the GUI.
      </td>
    </tbody>
  </table>
</div>
<pre>
  <ks>Thermometer</ks> simulates a temperature <ks>TA</ks> > <ks>TMAX</ks><br>
  <b>wait</b> <br>
  System checks new fan and transport trolley status<br>
  Thermometer simulates a temperature <ks>TA</ks> < <ks>TMAX</ks><br>
  <b>wait</b> <br>
  System checks new <ks>fan</ks> and <ks>transport trolley</ks> status<br>
</pre>
<div id="alarm_situation">
  <h3>User story: DTFREE OUTDOOR-AREA </h3>
  <table style="width:98%" cellpadding="5%">
    <tbody>
      <td>
        Initially the outsonar detects the presence of a car in the <ks>OUTDOOR-area</ks> and refers it to the <ks>ParkManagerService</ks>. If the car is still waiting in the
        <ks>OUTDOOR-area</ks> within the <ks>DTFREE</ks> time the <kr>ParkManagerService</kr> sends an <b>ALARM</b> signal to the <ks>ParkServiceStatusGui</ks>. The manager is now aware of the situation.
      </td>
    </tbody>
  </table>
</div>
</div>
<pre>
  <ks>Outsonar</ks> simulates the presence of a car for a time <ks>T</ks> > <ks>DTFREE</ks><br>
  <ks>ParkServiceStatusGui</ks> checks if an alarm has been received<br>
</pre>
-->

<h2>Problem analysis</h2>

<div class="remark">
  The system is made up of a series of distributed heterogeneous components that must communicate with each others.
  From their interaction arises the problem of evaluating the technologies to be used for the transmission of information in the best possible way.
  Another problem can be found in the management of the transport trolley as a core feature of the parking system.<br>
</div>
  This <a href="./Legenda.odp">legend</a> will be used to represent the components in the problem analysis.

<!--
<div>
  <h4>System overview</h4>
  <table style="width:98%" cellpadding="5%">
    <tbody>
      <tr>
        <td style="width:60%" style="text-align:top">
          The side image shows a schematic view of the system, including components and users.<br>
          As can be seen from the image, the core system is the hub of the system and plays the role of mediator
          between components. For this reason, the central system is the same entity which elaborates information and schedules
          tasks for interacting components.
          The interaction between those entities takes place via network or via different networks using messages. Data transmission
          and message format will be described below.
        </td>
        <td><center><img src="IMG/SYSTEM OVERVIEW.jpg" alt="SystemOverview" width="90%"></center></td>
      </tr>
    </tbody>
  </table>
</div>
-->
<div id="System_communication_overview">
  <h4>System communication overview</h4>
  <div class="remark">
    The interaction can be generally expressed as <ks>procedure calls</ks> or <ks>message based</ks>. However,
    since a distributed system is being developed, communication is a major aspect of the system itself and fit best in a message based interaction. <br>
    Depending on the nature and task of each component of the system, they will need a different form of interaction.
  <br>
    Moreover, in order to use this semantic, the system can relies on different communication protocol:
    <ul>
      <li><ks>websocket</ks>;</li>
      <li><ks>HTTP</ks>;</li>
      <li><ks>MQTT</ks>;</li>
      <li><ks>COaP</ks>.</li>
    </ul>
    Afterwards, for every component will be discussed the best communication solution according to its task.
  </div>
</div>
<h4>Components overview</h4>
<div>
  <h3> ParkManagerService </h3>
<div class="remark" id="problem_analysis_park_manager_service">
  The ParkManagerService (<b>PMS</b>) is the core of the entire software system as it contains the business logic.
  Acting like the system 'hub', the <kr>PMS</kr> can be described as a <ks>service</ks>, managing various types of information coming from external sensors,
  receving messages or commands from clients or the manager and controlling the transport trolley and the fan.
</div>
  <h3> Transport trolley </h3>
<div class="remark">
  <ks>Transport trolley</ks> must satisfy these requirements: <a href="#R2A">R2A</a>, <a href="#R2C">R2C</a>, <a href="#R2D">R2D</a>, <a href="#R2E">R2E</a>, <a href="#R3B">R3B</a>, <a href="#R3C">R3C</a>, <a href="#R3D"> R3D</a>.<br>
  At any time, parking manager is allowed to stop these tasks. Transport trolley aim leads to both active and passive behaviour. <br>
  As discussed in the requirements analysis, the <ks>transport trolley</ks> is represented as an actor. Since <ks>PMS</ks> contains the business logic of the
  service, it must know the status of the <ks>transport trolley</ks>. At the same time, <ks>PMS</ks> must be able to complete other tasks. For that reason,
  a non-blocking communication using <b>dispatches</b> is more situable. Alternatively, a <b>synchronous communication</b> would force the <ks>PMS</ks> to wait
  the reply of the <ks>transport trolley</ks> after a command making the service less reactive.
</div><br>
<table cellpadding="20%" style="border: 0px solid transparent;width:98%;" style="width:98%">
  <tr>
    <td style="border: 0px">
        <center><img src="IMG/TRANSPORT TROLLEY.jpg" alt="TRANSPORTROLLEY" width="60%"></center>
    </td>
    <td style="border: 0px">
      <center><table cellpadding="5%">
        <tbody><tr>
            <th>Message</th>
            <th>Content</th>
            <th>Semantic</th>
        </tr>
        <tr>
            <td rowspan="6">command</td>
            <td>t_moveToIn</td>
            <td rowspan="6">dispatch</td>
        </tr>
        <tr>
            <td>t_moveToOut</td>
        </tr>
        <tr>
            <td>t_moveToSlotIn</td>
        </tr>
        <tr>
            <td>t_moveToSlotOut</td>
        </tr>
        <tr>
            <td>t_backToHome</td>
        </tr>
        <tr>
            <td>t_stop</td>
        </tr>
        <tr>
            <td rowspan="4">reply</td>
            <td>ok</td>
            <td rowspan="4">dispatch</td>
        </tr>
        <tr>
            <td>wait</td>
        </tr>
        <tr>
            <td>fail</td>
        </tr>
        <tr>
            <td>ok(x,y)</td>
        </tr>
    </tbody></table></center>
  </td>
</tr>
</table>
<br>
<h3> Fan </h3>
<div class="remark">
The <ks>fan</ks> does not own or produce any valuable information by itself but it is a component controlled by the system.
Fan status can be changed by the <ks>PMS</ks> through two commands "<kr>turn_on</kr>" and "<kr>turn_off</kr>" respectively to turn it on and to turn it off. As a result of the command, the fan replies
with its new state. This implies that the fan can only be in two states, one is "on" which indicates that the fun is working while the second one "off" suggests that the fun is not working.
In case of electric disguise or general failure of the application, the fan must be able to reply with its current
state whenever the <ks>PMS</ks> requests its state of activation. Similarly to the <ks>transport trolley</ks>, the interaction between the two entities is more predisposed to a <b>synchronous semantics</b>.
</div> <br>
<table cellpadding="20%" style="border: 0px solid transparent;width:98%;" style="width:98%">
  <tr>
    <td style="border: 0px">
        <center><img src="IMG/FAN.jpg" alt="FAN" width="60%"><center>
    </td>
    <td style="border: 0px">
      <center><table cellpadding="5%">
        <tbody><tr>
            <th>Message</th>
            <th>Content</th>
            <th>Semantic</th>
        </tr>
        <tr>
            <td rowspan="3">command</td>
            <td>turn_on</td>
            <td rowspan="3">request</td>
        </tr>
        <tr>
            <td>turn_off</td>
        </tr>
        <tr>
            <td>req_status</td>
        </tr>
        <tr>
            <td rowspan="2">rep_status</td>
            <td>on</td>
            <td rowspan="2">reply</td>
        </tr>
        <tr>
            <td>off</td>
        </tr>
    </tbody></table></center>
  </td>
</tr>
</table>
<br>
<hr size="4" color="black">
<br>
<div class="remark">
  Requirements analysis shows that the <ks>outsonar</ks>, the <ks>thermometer</ks> and the <ks>weight-sensor</ks> are autonomous active
  components which emit information in a continuous way. For this reason, the sensors below don't need any replies during the interaction with the <ks>PMS</ks>.
 <br>
  This behaviour leads to an asynchronous communication that can be developed through different forms:
  <ul>
    <li><b>Polling</b>: where the <ks>PMS</ks> makes, at a regular interval of time, requests to sensors;</li>
    <li><b>Dispatches</b>: sent from sensor to the <ks>PMS</ks>;</li>
    <li><b>Events</b>: generated from sensors and sent in broadcast through networks.</li>
  </ul>
  Following the discussion with the customer, each of these components isn't aware about the rest of the system.
  This leads to events being the best form of interaction between components and the <ks>PMS</ks>.
</div>
<div id="problem_analysis_out_sonar">
  <h3> Out-Sonar </h3>
  <div class="remark">
    Data from the <ks>out-sonar</ks> is used when a client starts the <ks>acceptOUT</ks> procedure and to trigger the alarm procedure
    if it detects a car in the <ks>OUTDOOR-AREA</ks> for more than <ks>DFTREE</ks> time.
    Moreover, as previously stated, <ks>out-sonar</ks> emits events which contain the <b>distance misured</b> and the relative <b>timestamp</b>.<br>
    Customer's <a href="./SonarAlone.c">SonarAlone.c</a> can be used in order to simplify the development of this component.
    <br>
  </div>
  <table cellpadding="20%" style="border: 0px solid transparent;width:98%;" style="width:98%">
    <tr>
      <td style="border: 0px">
          <center><img src="IMG/OUTSONAR.jpg" alt="OUTSONAR" width="60%"><center>
      </td>
      <td style="border: 0px">
        <center>
    <table cellpadding="5%">
        <tr>
          <th>Message</th>
          <th>Content</th>
          <th>Type</th>
        </tr>
        <tr>
          <td>event</td>
          <td>distance, timestamp</td>
          <td>event</td>
        </tr>
   </table>
 </center>
</td>
</tr>
</table>
</div>
<div id="problem_analysis_weight_sensor">
  <h3>Weightsensor</h3>
    <div class="remark">
      Data from <ks>weightsensor</ks> is used when a client starts the <ks>acceptIN</ks> procedure by pressing the <ks>CARENTER</ks> button. Like the sonar,
      the <ks>weightsensor</ks> has to emit events which contains the weight measured and the relative timestamp in order to guarantee data freshness. <br>
    </div>
      <table cellpadding="20%" style="border: 0px solid transparent;width:98%;" style="width:98%">
        <tr>
          <td style="border: 0px">
              <center><img src="IMG/WEIGHTSENSOR.png" alt="WEIGHTSENSOR" width="60%"><center>
          </td>
          <td style="border: 0px">
            <center>
      <table cellpadding="5%">
        <tbody>
          <tr>
            <th>Message</th>
            <th>Content</th>
            <th>Type</th>
          </tr>
          <tr>
            <td>event</td>
            <td>weight, timestamp</td>
            <td>event</td>
          </tr>
        </tbody>
    </table>
  </center>
 </td>
 </tr>
 </table>
</div>
<div id="problem_analysis_thermometer">
  <h3>Thermometer</h3>
  <div class="remark">
    <ks>Thermometer</ks> measures the temperature of the parking room and sends events to the <ks>PMS</ks>. Since temperature usually doesn't change
    that quickly, events can be sent at regular time interval which can help the application to rely in a less bandwidth usage. The time interval
    must take into account of the position of the thermometer in the parking room.
  </div>
  <table cellpadding="20%" style="border: 0px solid transparent;width:98%;" style="width:98%">
    <tr>
      <td style="border: 0px">
          <center><img src="IMG/THERMOMETER.png" alt="THERMOMETER" width="60%"><center>
      </td>
      <td style="border: 0px">
        <center>
  <table cellpadding="5%">
    <tbody>
      <tr>
        <th>Message</th>
        <th>Content</th>
        <th>Type</th>
      </tr>
      <tr>
        <td>event</td>
        <td>temperature, timestamp</td>
        <td>event</td>
      </tr>
    </tbody>
</table>
</center>
</td>
</tr>
</table>
</div>
<div id="problem_analysis_map">
  <h3> Map </h3>
  <div class="remark">
    The <ks>map</ks> is a passive element that is used by the <ks>PMS</ks> to manage the state of the parking-area.
    In order to simplify the use of the map, it is represented by an image composed of different symbols:
    <ul>
      <li>the symbol <b>h</b> represent the "home" position of the trasport trolley;</li>
      <li>the symbol <b>0</b> represents an area where the trasport trolley can move;</li>
      <li>the numbers from <b>1</b> to <b>6</b> represent the parking slots, where the cars can be parked. The specific number is the SLOTNUM used by the core system;</li>
      <li>the symbol <b>|</b> represents a wall;</li>
      <li>he symbol <b>i</b> represents the position of coordinates (6,0), where a car is left by a client;</li>
      <li>the symbol <b>o</b> represents the position of coordinates (6,4), where a car is brought by the trasport trolley to be picked up by the customer.</li>
  </ul>
  <img src="IMG/map.png" alt="MAP" width="20%">
  </div>
</div>
<div id="problem_analysis_GUI_overview">
  <h4>GUI overview</h4>
  <div class="remark">
    In an attempt to achieve a wider catchment area and to guarantee simplicity and portability both GUIs should be web
    interfaces. In that case, <a href="https://spring.io/"><b>Spring</b></a>,
    <a href="https://sparkjava.com/"><b>Spark</b></a> and <a href="https://grails.org/"><b>Grails</b></a>
      frameworks are technologies that can be used to simplify the development of the two GUIs.
    Furthermore, both client and manager interfaces should be clear and user-friendly.
  </div>
</div>
<div id="problem_analysis_parking_service_status_GUI">
  <h3>ParkServiceStatusGUI</h3>
  <div class="remark">
    Manager's interface must be able to send commands to the fan and the <ks>trasport trolley</ks> as well as receive and show details
    about current system status. Another key functionality that the manager's interface must integrate is the ability
    to receive and show in a proper way the alarm signal.<br>
    The system behaviour results in two type of interaction between the <ks>ParkServiceStatusGUI</ks> and the <ks>PMS</ks>:
    <ul>
      <li>to stop/resume both fan and trasport trolley with a request/response semantic. This
      allows both entities to know if a command was successful or not. Alternatively, a dispatch semantic can be used to make the interaction less constrained;</li>
      <li>to receive data about the current status of the system with a dispatch or invitation semantic. <!-- This allows to
      reply the system with an ack about the Information received. That mechanism is fundamental
      especially when the alarm is triggered.--></li>
    </ul>
    Below a <a id="status">detailed list</a> of what the GUI must show:
    <ul>
      <li>status of the <ks>fan</ks> (<b>on/off</b>);</li>
      <li>status of the <ks>transport trolley</ks> (<b>idle/working/stopped</b>);</li>
      <li><ks>temperature</ks> of the room (expressed in celsius degrees);</li>
      <li>status of the <ks>INDOOR-area</ks> (through weightsensor data);</li>
      <li>status of the <ks>OUTDOOR-area</ks> (through outsonar data);</li>
    </ul>
    In addiction, the GUI should contain a series of buttons to interact with:
    <ul>
      <li><kr>ACTIVATE</kr>/<kr>DEACTIVATE</kr> button for the fan;</li>
      <li><kr>STOP</kr>/<kr>RESUME</kr> task button for the transport trolley;</li>
      <li><kr>STOP</kr> button if the alarm is triggered;</li>
    </ul>
    The gui must also be able to capture the park manager's attention via visual and additionally audible cues when the alarm is triggered.<br>
  </div>
  <table cellpadding="20%" style="border: 0px solid transparent;width:98%;" style="width:98%">
    <tr>
      <td style="border: 0px">
        <center><img src="IMG/MANAGERGUI.png" alt="ParkingServiceStatusGUI" width="65%"></center>
      </td>
      <td style="border: 0px">
        <center>
          <table cellpadding="5%">
            <tbody>
              <tr>
                <th>Message</th>
                <th>Content</th>
                <th>Type</th>
              </tr>
              <tr>
                <td rowspan="5">Command</td>
                <td>turn_on</td>
                <td rowspan="5">request</td>
              </tr>
              <tr>
                <td>turn_off</td>
              </tr>
              <tr>
                <td>resume_work</td>
              </tr>
              <tr>
                <td>stop_work</td>
              </tr>
              <tr>
                <td>stop_alarm</td>
              </tr>
              <tr>
                <td rowspan="2">Reply</td>
                <td>ok</td>
                <td rowspan="2">reply</td>
              </tr>
              <tr>
                <td>
                  fail
                </td>
              </tr>
              <tr>
                <td>System Status</td>
                <td><a href="#status">check above</a></td>
                <td>dispatch</td>
              </tr>
              <tr>
                <td>Alarm</td>
                <td>alarm_situation</td>
                <td>dispatch</td>
              </tr>
            </tbody>
          </table>
        </center>
      </td>
    </tr>
  </table>
</div>
<div id="problem_analysis_parking_service_GUI">
  <h3> ParkServiceGUI </h3>
  <div class="remark">
  Client's interface must be able to send commands to the <ks>PMS</ks> in order to park client's car, receive a
  receipt and to pick up the car using the same receipt. These three phases consist in <a href="#R1">R1</a>, <a href="#R2B">R2B</a> and <a href="#R3">R3</a> requirements.
  These requirements are satisfied using a request/response communication. This type of communication is needed due to the fact that the client needs
  a feedback everytime he asks for a service. <br>
  Another feature that the <ks>ParkServiceGUI</ks> must implement is the capability of receiving an alert if the car stands at the outdoor area for more than <ks>TMAX</ks>.
  Alerts are a type of information sent by the <ks>PMS</ks> which don't require replies.
  </div>
  <table cellpadding="20%" style="border: 0px solid transparent;width:98%;" style="width:98%">
    <tr>
      <td style="border: 0px">
        <center><img src="IMG/PARKSERVICEGUI.png" alt="ParkingServiceGUI" width="65%"></center>
      </td>
      <td style="border: 0px">
        <center>
          <table cellpadding="5%">
            <tbody>
              <tr>
                <th>Message</th>
                <th>Content</th>
                <th>Type</th>
              </tr>
              <tr>
                <td rowspan="3">Command</td>
                <td>acceptIN</td>
                <td rowspan="3">request</td>
              </tr>
              <tr>
                <td>CARENTER</td>
              </tr>
              <tr>
                <td>acceptOUT</td>
              </tr>
              <tr>
                <td rowspan="5">Reply</td>
                <td>ok</td>
                <td rowspan="5">reply</td>
              </tr>
              <tr>
                <td>
                  fail
                </td>
              </tr>
              <tr>
                <td>
                  wait
                </td>
              </tr>
              <tr>
                <td>
                  TOKENID
                </td>
              </tr>
              <tr>
                <td>
                  SLOTNUM
                </td>
              </tr>
              <tr>
                <td rowspan="3">Alert</td>
                <td>free_indoor_area</td>
                <td rowspan="3">dispatch</td>
              </tr>
              <tr>
                <td>
                  pick_up_available
                </td>
              </tr>
              <tr>
                <td>
                  pick_up_needed
                </td>
              </tr>
            </tbody>
          </table>
        </center>
      </td>
    </tr>
  </table>
</div>
<!--
<div id="core_system_overview">
  <h4>Core System Overview</h4>
  <div class="remark">
    The core system is the most important component of the entire software system because it contains the business logic.
    Acting like the system 'hub', it manages various types of information coming from external sensors, it receives messages or
    commands from clients or the manager and it controls the transport trolley and the fan.
    For its complexity and by following a 'divide-et-impera' approach and single responsability priciple, the core system could be divided in four different actors:
  </div>
  <center><img src="IMG/CORESYSTEM.png" alt="CoreSystem" width="35%"></center>
  <div class="remark">
    <ul>
      <li><b>business logic actor</b>: process key functionalities for the entire system:
        <ul>
          <li>receive information from the data collector actor;</li>
          <li>manage and maintain parking availability;</li>
          <li>manage transport trolley's state;</li>
          <li>manage automatically the fan or after a manager's command;</li>
          <li>interaction between the manager and clients through the GUI controller actor and the generation and collection of the TOKENID.</li>
        </ul>
      </li>
      <li><b>actuators controller actor</b>: it interacts with components which are able to receive commands. In particular:
        <ul>
          <li>simply redirects commands from the business logic to the fan;</li>
          <li>given initial and final coordinates from the business logic, generates the best path for the transport trolley to follow;</li>
          <li>allows future integration with new active components much easier.</li>
        </ul>
      </li>
      <li><b>data collector actor</b>: it is responsible for receiving and elaborating information from the sensors usable by the business logic actor;</li>
      <li><b>GUI controller actor</b>: it is placed between the business logic actor and GUIs. It gets information from GUIs and forwards them
        to the business logic actor and respectively sends datas from the business logic actor to clients' GUI.</li>
    </ul>
  </div>
</div>
-->
<div id="abstraction_gap">
  <h3>Abstraction gap</h3>
  <div class="remark">
    The problem analysis was carried out to highlight the requirements without focusing on used technologies by introducing high-level concepts.
    Another goal was the development of a code as independent as possible from the technology used for the transport trolley in order to
    make it easier to replace it if necessary. The abstraction between system design and available
    technologies is facilitated thanks to the presence of modern programming languages such as Kotlin that allows the definition of actors. However,
    Kotlin doesn't solve the distributed management of actors. Finally,
    the use of particular technologies to deal with problems such as data persistence and failure resistance leads to a wider gap.
  </div>
</div>
<div id="system_weakness">
  <h4>System weaknesses</h4>
  <div class="remark">
    The system may soffer some rare case studies:
    <ul>
      <li>If the parking manager isn't well trained about system functionalities he may create a bottleneck of requests simply stopping transport trolley tasks
        through his GUI. In fact, the system isn't developed in a way that can't stop wrong decision by the parking manager;</li>
      <li>Considering the distributed nature of the system, network problems lead to a malfunction of the entire system;</li>
      <li>Some information is kept by the business logic in order to manage the system. In case of system faults, these data can be lost.</li>
    </ul>
  </div>
</div>
<div id="architectural_model">
  <h3>Logical Architecture</h3>
  From the previous considerations on the components of the system it is possible to define a first logical architecture: <br><br>
  <center><img src="IMG/LOGICAL ARCHITECTURE.png" alt="architectural_model" width="40%"></center>
  <div class="remark">
    The information about the status of the components can be centralized or kept in a distributed way. In order to satisfy GUIs requirements, a centralized management
    would be more easily implemented. However, the centralized management is open to single point of failure.
  </div>
  <div class="remark">
    In order to make our parking software reusable and as much as possibile independent from the undelying communication protocols,
    the designer could make reference to proper design pattern such as <b>adapter</b>, <b>bridge</b> and <b>facade</b>. Other design pattern that might be considered during
    the development are <b>singleton</b>, <b>observer</b> and <b>layer</b>.
  </div>
  <div class="remark">
    From the different user stories given by the customer, a model of the first phase (<b>client - parking phase</b>) will be developed using the Qak meta-modelling language.
    The simplified version of the system is based on a series of assumptions:
    <ul>
      <li>INDOOR cell (6,0) / OUTDOOR cell (6,4);</li>
      <li>temperature under <ks>TMAX</ks>;</li>
      <li>one client;</li>
      <li>free INDOOR-area;</li>
      <li>no interaction from parking manager;</li>
      <li>one free parking slot (3,3) <ks>SLOTNUM</ks> = 6.</li>
    </ul>
  </div>
</div>
<div id="estimate_effort">
  <h3>Estimate delivery time</h3>
  <div class="remark">
    Following these assumptions the model can be developed in two working days. The first one will be used by a single member of the team to develop the model.
    The first half of the second day will be used by the team to discuss the model produced, meanwhile the second half will be used to fix
    and audit changes proposed previously.
  </div>
</div>
The model is available <a href="https://github.com/enriLoniterp/iss2021project/blob/main/requirements/model_prob_an/src/requirements.qak">here</a>.
<h2>Test plans</h2>
<div id="test_plans">
  <div class="remark">
    Features presented in <b>client - parking phase</b> user story are tested following four test plans. These tests have been defined according with
    assumptions made before and some different configuration:
    <ol>
      <li><U>Slot 6 free</U>. Client makes a request to enter, it is accepted by the <ks>PMS</ks> and the client receives <b>6</b> (linked to the parking slot) as response;</li>
      <li><U>all the parking slots are occupied </U>. Client makes a request to enter and receives number <b>0</b> as response;</li>
      <li><U>the INDOOR-AREA isn't available</U>. Client makes a request to enter receives a waiting message.</li>
      <li><U>INDOOR-AREA free</U>. Client makes <ks>CARENTER</ks> request and receives <ks>TOKENID</ks> as response.</li>
    </ol>
  </div>
</div>
Test plans are based on the model developed and are available <a href="https://github.com/enriLoniterp/iss2021project/blob/main/requirements/model_prob_an/src/tests/TestPlan.kt">here</a>.
<h2>Work Plan</h2>
<div id="work_plan">
  <div class="remark">
    The first product backlog can be defined starting from the previous analysis. The chart contains the following items ordered by priority.<br><br>
    <table id="product_backlog" cellpadding="5%">
      <tr>
        <th>ID</th>
        <th>PRIORITY</th>
        <th>ITEM</th>
        <th>REQUIREMENTS</th>
      </tr>
      <tr>
        <td><b>1</b></td>
        <td>HIGH</td>
        <td><ks>PMS</ks> processes car deposit requests</td>
        <td><a id="#R1">R1</a>, <a id="#R2">R2</a>, <a id="#R2B">R2B</a></td>
      </tr>
      <tr>
        <td><b>2</b></td>
        <td>HIGH</td>
        <td><ks>PMS</ks> processes car pick-up requests</td>
        <td><a id="#R3">R3</a></td>
      </tr>
      <tr>
        <td><b>3</b></td>
        <td>HIGH</td>
        <td><ks>PMS</ks> manages data from sensors</td>
        <td><a id="#R1">R1</a>, <a id="#R3">R3</a></td>
      </tr>
      <tr>
        <td><b>4</b></td>
        <td>HIGH</td>
        <td><ks>PMS</ks> manages transport trolley</td>
        <td><a id="#R2A">R2A</a>, <a id="#R2C">R2C</a>, <a id="#R2D">R2D</a>, <a id="#R2E">R2E</a> <a id="#R3A">R3A</a>, <a id="#R3B">R3B</a>, <a id="#R3C">R3C</a>, <a id="#R3C">R3C</a></td>
      </tr>
        <td><b>5</b></td>
        <td>MEDIUM</td>
        <td><ks>PMS</ks> satisfies manager's start and stop fan requests</td>
        <td><a id="#R4">R4</a></td>
      </tr>
      <tr>
        <td><b>6</b></td>
        <td>MEDIUM</td>
        <td><ks>PMS</ks> satisfies manager's start and stop trolley requests</td>
        <td><a id="#R5">R5</a></td>
      </tr>
      <tr>
        <td><b>7</b></td>
        <td>MEDIUM</td>
        <td><ks>PMS</ks> maintains an updated version of the system status</td>
        <td><a id="#R4">R4</a></td>
      </tr>
      <tr>
        <td><b>8</b></td>
        <td>MEDIUM</td>
        <td><ks>PMS</ks> recognizes critical OUTDOOR-area situation and generates an alarm for the manager</td>
        <td><a id="#R4">R4</a></td>
      </tr>
      <tr>
        <td><b>9</b></td>
        <td>LOW</td>
        <td><ks>PMS</ks> asks the client to pick up his car due a DTFREE timeout</td>
        <td></td>
      </tr>
      <tr>
        <td><b>10</b></td>
        <td>LOW</td>
        <td><ks>PMS</ks> manages fan automatically</td>
        <td></td>
      </tr>
    </table>
    <br>All the items above can be group in several sprint as datailed in the next table:<br><br>
    <table id="sprint" cellpadding="5%">
      <tr>
        <th>SPRINT GOAL</th>
        <th>BACKLOG ITEM IDS</th>
      </tr>
      <tr>
        <td><ks>PMS</ks> basic functionalities</td>
        <td><b>3</b>, <b>4</b></td>
      </tr>
      <tr>
        <td><ks>PMS</ks> able to manage user requests</td>
        <td><b>1</b>, <b>2</b></td>
      </tr>
      <tr>
        <td><ks>PMS</ks> interaction with manager and care of system status</td>
        <td><b>5</b>, <b>6</b>, <b>7</b>, <b>8</b></ul>
        </td>
      </tr>
      <tr>
        <td><ks>PMS</ks> Optimization</td>
        <td><b>9</b>, <b>10</b></ul>
        </td>
      </tr>
    </table>
  </div>
</div>


<h2>Project</h2>

</div>

<h2>Testing</h2>


<h2>Deployment</h2>


<h2>Maintenance</h2>

<!-- USEFUL
<table style="width:100%" border="1">
<tr>
<td style="width:50%">
</td>
<td></td>
</tr>
</table>
-->

<br/><br/>
</div>

<div style="background-color:rgba(86, 56, 253, 0.9); width:60%;text-align:left;color:white">
By studentName email: giuseppe.cristaudo@studio.unibo.it, filippo.manfreda@studio.unibo.it, enrico.andrini@studio.unibo.it
<!--<img src="./img/emiglio.png" alt="mbot" width="15%" height="15%">-->
</div>
</body>
</html>
