<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
    <!--
<link rel="stylesheet" type="text/css" href="../css/issStyle1.css">
<script type="text/javascript" src="../css/issStyle.js"></script>
-->
<style type="text/css">
body
{
    margin-left:  30px;
    margin-right: 30px;
};

P
{
    font-family: Tahoma;
    font-size: 10pt;
};

a, a:visited, a:active, a:link, a:hover {
    text-decoration: underline;
    color: #545454;
    background-color: transparent;
	font-size: 93%;
}

a:hover {
    background-color: #cccccc;
}


hr {
    clear: both;
    height: 1px;
    color: #242424;
    background-color: transparent;
}

h1, h2, h3 {
    color: #242424;
    clear: left;
    font: 100% Tahoma, Helvetica, Arial, sans-serif;
    margin-bottom: 0.5em;
    padding-top: 0.5em;
	border-radius: 10px;
	padding: 5px;
}

top {
	width: 100%;
}


#i {
    color: #ff1010;
}
tt{
	font-family: "Arial";
    font-size: 90%;
	color: #006600;
}
em{
	font-family: "Arial";
    font-size: 80%;
	font-weight: bold;
	border-style:solid;
	border-color: #abe876;
    color: #1632cc;
}
bc{
	font-family: "Arial";
	font-size: 90%;
	font-weight: bold;
    color: #990000;
	background-color: #fcf8c7;
}
ks{
	font-family: "Arial";
	font-weight: bold;
    color: #0000CD	;
	font-size: 90%;
}
kc{
	font-family: "Arial";
	font-weight: bold;
    color: #008000	;
	font-size: 90%;
}
kr{
	font-family: "Arial";
	font-weight: bold;
    color: #ff0000	;
	font-size: 90%;
}
pre{
	font-family: "Consolas";
	font-size: 85%;
	background-color: #f5f5f5;
	border: 1.5px solid silver;
	padding: 5px;
}
m{
	font-family: "Helvetica";
	line-height: 100%;
 	font-size: 75%;
}
div.body{

    font-size: 18px;
}
k{
    color: #990000;
	font-weight: bold;
	font-size: 90%;
}
h1 {
    font-size: 150%;
    background-color: #b2c0ff;
	padding: 10px;
}

h2 {
    background-color: #9ed8ff;
    font-size: 130%;
}

h3 {
	background-color: #e6ccff;
    font-size: 100%;
}
h4 {
    background-color: #ccffcc;
    font-size: 100%;
	width: 95%;
	border-radius: 5px;
	padding: 2px;
}
h5 {
    background-color: #d5ffb0;
    font-size: 100%;

}
div.req{
	background-color: #d9ffb3;
    font-size: 18px;
	width: 700px;
    border: 3px solid green;
    padding: 15px;
    margin: 10px;
}
div.remark{
	background-color: #E3F2FD;
    border: 1.5px solid #d5f2ed;
    padding: 15px;
    margin: 10px;
	border-radius: 25px;
}
table, th, td {
  border: 1px solid black;
  border-collapse: collapse;
}

#exampleclass tbody,
#exampleclass thead,
#exampleclass th {
  border: 0;
}

ol, ul, li {
  margin: 0;
  margin-left: 10px;
  padding: 0;
  padding-bottom: 5px;
}

table, th, td {
	border: 1px solid black;
}

img {
	border: 1.5px solid #d5f2ed

}

a, a:visited, a:active, a:link, a:hover {
    text-decoration: underline;
    color: #545454;
    background-color: transparent;
}

div.wrapdesc{
	width: 90%;
	margin: auto;
}

div.imagedesc{
	width: 85%;
	margin: auto;
}
</style>

<head>

<title>Final task ISS-2021 Bologna: Automated Car-Parking - Sprint 1</title></head>

<body>
<div id="top">
<h1>Final task ISS-2021 Bologna: Automated Car-Parking - Sprint 1<font size="5"></font> </h1>
</div>

<div class="body">

<div id = "requirements">
  <h2>Requirements</h2>
  <div id="Requirements" class="remark">
    The <kr>ParkManagerService</kr> should create the <kr>ParkServiceGUI</kr> (for the client) and the <kr>ParkServiceStatusGUI</kr> (for the manager)
    and then perform the following tasks:
    <ul>
      <li><ks><a id="R1">(R1)</a> acceptIN</ks>: accept the request of a client to park the car if there is at least one <kr>parking-slot</kr> available,
        select a free slot identified with a unique <kr>SLOTNUM</kr>.
        A request of this type can be elaborated only when the <kr>INDOOR-area</kr> is free, and the <kr>transport trolley</kr> is at <kr>home</kr> or working
        (not stopped by the manager). If the <kr>INDOOR-area</kr> is already engaged by a car, the request is not immediately processed (the client could simply
        wait or could - optionally - receive a proper notice).</li>
      <li><ks><a id="R2">(R2)</a> informIN</ks>: inform the client about the value of the <kr>SLOTNUM</kr>.</li>
      </ul>
      If <b>SLOTNUM</b> > 0:
      <ol>
        <li><ks><a id="R2A">(R2A)</a> moveToIn</ks>: move the <kr>transport trolley</kr> from its current localtion to the <kr>INDOOR</kr>;</li>
        <li><ks><a id="R2B">(R2B)</a> receipt</ks>: send to the client a receipt including the value of the <kr>TOKENID</kr>;</li>
        <li><ks><a id="R2C">(R2C)</a> moveToSlotIn</ks>: move the <kr>transport trolley</kr> from the <kr>INDOOR</kr> to the selected <kr>parking-slot</kr>;</li>
        <li><ks><a id="R2D">(R2D)</a> backToHome</ks>: if no other request is present, move the <kr>transport trolley</kr> to its <kr>home</kr> location, else <ks>acceptIN</ks> or <ks>acceptOUT</ks>.</li>
      </ol>
      If <b>SLOTNUM</b> == 0:
      <ul>
        <li><ks><a id="R2E">(R2E)</a> moveToHome</ks>: if not already at home, move the <kr>transport trolley</kr> to its <kr>home</kr> location.</li>
      </ul>
      <hr size="4" color="black">
      <ul>
        <li><ks><a id="R3">(R3)</a> acceptOUT</ks>: accept the request of a client to get out the car with <kr>TOKENID</kr>. A request of this type can be
          elaborated only when the <kr>OUTDOOR-area</kr> is free and the <kr>transport trolley</kr> is at <kr>home</kr> or working (<b>not stopped</b> by the manager).
          If the <kr>OUTDOOR-area</kr> is still engaged by a car, the request is not immediately processed (the client could simply wait or could -
          optionally - receive a proper notice).</li>
      </ul>
      <ol>
        <li><ks><a id="R3A">(R3A)</a> findSlot</ks>: deduce the number of the parking slot (<ks>CARSLOTNUM</ks>) from the <kr>TOKENID</kr>;</li>
        <li><ks><a id="R3B">(R3B)</a> moveToSlotOut</ks>: move the <kr>transport trolley</kr> from its current localtion to the <kr>CARSLOTNUM</kr>/<kr>parking-slot</kr>;</li>
        <li><ks><a id="R3C">(R3C)</a> moveToOut</ks>: move the <kr>transport trolley</kr> to the <kr>OUTDOOR</kr>;</li>
        <li><ks><a id="R3D">(R3D)</a> moveToHome</ks>: if no other request is present move the <kr>transport trolley</kr> to its <kr>home</kr> location;<br>
          else <ks>acceptIN</ks> or <ks>acceptOUT</ks>
      </ol>
      <hr size="4" color="black">
      <ul>
        <li><ks><a id="R4">(R4)</a> monitor</ks>: update the <kr>ParkServiceStatusGUI</kr> with the required information about the state of the system.</li>
      </ul>
      <hr size="4" color="black">
      <ul>
        <li><ks><a id="R5">(R5)</a> manage</ks>: accept the request of the manager to stop/resume the behavior of the <kr>transport trolley</kr>.</li>
      </ul>
    <br>
    The analysis of these requirements is available <a href="first_analysis.html#requirements">here</a>
  </div>
</div>
<div id = "backlog">
  <h2>Sprint 1 Backlog</h2>
  <div class="remark">
    Sprint 1 regards the develop of the <ks>PMS</ks> basic functionalities:
    <ul>
      <li><ks>PMS</ks> manages data from sensors: <a href="#R1">R1</a>, <a href="#R3">R3</a>;</li>
      <li><ks>PMS</ks> manages transport trolley: <a href="#R2A">R2A</a>, <a href="#R2C">R2C</a>, <a href="#R2D">R2D</a>, <a href="#R2E">R2E</a> <a href="#R3A">R3A</a>, <a href="#R3B">R3B</a>, <a href="#R2C">R3C</a>, <a href="#R3C">R3C</a>;</li>
    </ul>
  </div>
</div>
<h4>Starting point</h4>
<center><img src="IMG/StartingPoint.png" alt="starting_point_sprint1" width="60%"></center>


<div id = "problem_analysis">
<h2>Problem analysis</h2>
<div class="remark">
  This Sprint aim to develop and deeper describe the following entities:
  <ul>
    <li><ks>PMS</ks>;</li>
    <li><ks>Transport Trolley</ks>;</li>
    <li><ks>Outsonar</ks>;</li>
    <li><ks>Weightsensor</ks>;</li>
    <li><ks>Thermometer</ks>;</li>
  </ul>
</div>
<div class="remark">
  An initial model of these entities, without interaction between them, can be found <a href = "https://github.com/enriLoniterp/iss2021project/blob/main/Sprint1/model1/src/model1.qak">here</a>.<br>
</div>
<div id = "problem_analysis_PMS">
  <h3>PMS</h3>
  <div class="remark">
    From the <a href="#backlog">backlog</a>, the <ks>Park Manager System</ks> needs to manage:
    <ul>
      <li>Data from the outsonar, the weightsensor and the thermometer;</li>
      <li>Commands to the transport trolley.</li>
    </ul>
    With regard to these two tasks, in the <a href="first_analysis.html#problem_analysis">first analysis</a>, it was described how they are of a different nature.
    This difference suggests an independent management of the two activities. For that reason, a monolithic PMS should be avoided.
  </div>
  <h4>Communication summary</h4>
  <div class="remark">
    <ul>
      <li>Interaction between sensors and the <ks>PMS</ks> is <b>events based</b>;</li>
      <li>Interaction between the transport trolley and the <ks>PMS</ks> uses a <b>dispatch semantic</b>.</li>
    </ul>
  </div>
</div>
<h3> Transport trolley </h3>
<div class="remark">
  The <ks>transport trolley</ks> receives commands from the <ks>PMS</ks> and if needed generates the path required to complete its tasks. The path
  can be generated using <a href="https://raw.githubusercontent.com/anatali/issLab2021/master/it.unibo.cautiousExplorer/app/src/main/kotlin/itunibo/planner/plannerUtil.kt">plannerUtil.kt</a>
  provided by the customer which is based on intelligence artifical algorithms. <br>
  As pointed out during the first requirements analysis, in order to move the <ks>DDR Robot</ks>, the trasport trolley interacts with <a href="./basicrobot2021.html">basicrobot2021</a>
  by sending the sequence of moves to do. The basicrobot2021 grants technology indipendence since it can be configured to work with the WEnv virtual robot as well as real robots deployed
  on different systems such as Raspberry Pis or Arduinos.
</div>
<h3> Outsonar </h3>
<div class="remark">
  Outsonar data can be:
  <ul>
    <li>Generated by an user using a proper utility like <a>sonarDataSimulator.kt</a> or <a>sonarDataSimulatorCoap.kt</a> given by the client;</li>
    <li>Produced by a real sonar device placed in the outdoor area. In that case <a>SonarAlone.c</a> allows to read the data from the sonar and write it on the standard output.
      In addiction, data can be managed using <a>sonarHCSR04Support2021.kt</a></li>
  </ul>
  Moreover, there are two main component integration strategies in order to allow data to flow from the client <a>SonarAlone.c</a> to our component outsonar:
  <ul>
    <li>A direct end-to-end type of communication (e.g. HTTP, UDP or TCP);</li>
    <li>Using a middleware (e.g. MQTT broker or CoAP resource).</li>
  </ul>
</div>
<h3> Thermometer </h3>
<div class="remark">
  Non functional requirements: as themperature is a critical value and should be undervalued, it should be tracked in order to identify abnormal situation.
</div>
</div>
The sprint 1 should be done in <b>one week</b>.
<div id = "project">
<h2>Project</h2>
Starting from the <a>logical architecture</a> and from the <a href="#backlog">product backlog</a> we can now "zoom in" and design the entities pointed out in the analysis.<br>
To better manage complexity, it is advisable to adopt a “divide et impera” approach and follow the principle of single responsibility, thus making the system less fragile and more easily modifiable.
To help these needs, a <a href="https://alistair.cockburn.us/hexagonal-architecture/"><b>hexagonal architecture</b></a> will be used as it allows a more agile interaction with different entities and subjects.
<h3>PMS</h3>
Considering what has been said in the analysis phase and for how the architecture is conceived, the sensor management and trolley transport management
tasks can be represented by two separate entities:
<ul>
  <li><ks>dataCollector</ks>: manages data from outsonar, weightsensor and thermometer received as events and makes this data available to the business logic throught an interface;</li>
  <li><ks>actuatorsController</ks>.</li>
</ul>
The <ks>actuatorsController</ks> will subsequently also manage the <ks>fan</ks>,
the second actuator present in the system. Furthermore, another actor is introduced, the businessLogic which will represent the business logic of the service,
this is to separate responsibilities.

To develop a hexagonal architecture several adapters have been developed.

Communication:
<h3>Transport trolley</h3>
<h3>Outsonar</h3>
<div class="remark">
  After a discussion with the client, a requirements is that the outsonar have to be a physical sensor attached to a Raspberry Pi. In order to simplify the developed,
  we choose to use <a>SonarAlone.c</a> as a reading software and a <a>outsonarQAk</a> that allows to filter events sent by the physical sonar by communicating with
  the data aggregator only if the new distance measure is different from the previously one. This feature allows the <ks>PMS</ks> to handle less information and can be
  turned off by using its <a>configuration file</a>. In addiction, due to the fact that a real outsonar can generate spurios data, <a>dataCleaner.kt</a> given by the
  client will be used to filter spurios sonar-data.
  In alternative, for testing purpose, the data from the sonar can be simulated using <a>sonarDataSimulatorCoap.kt</a>. The <a>configuration gile</a> allows to choose
  beetween the real and the simulated sonar.
  <!-- inserire in qualche modo uso di CoAP-->
</div>
<h3>Weightsensor</h3>
<div class="remark">
  Since there aren't particular requirements for the weightsensor, it has been developed as a mock object <a>WeightSensorMock</a> that periodically emits events.
  As it is a constrained sensor, the component integration strategy uses CoAP protocol as a middleware. This strategy also allows the definition of the weightsensor
  as a restfull resource and so the possibily to enhance the use of an HTTP RESTful API which allows more flexibility and lightness.
</div>
<h3>Thermometer</h3>
<div class="remark">
  As for the weightsensor, the thermometer has been developed as a mock object <a>ThermometerMock</a> that periodically emits events. For the same reason,
  we again use the CoAP protocal as it is the protocol that is more suitable. <br>
  In addiction, as themperature is a critical attribute, we decide to periodically keep a log of the temperature inside the room. To do this, we use the property
  of qak-actor as a component of a pipe.
  <!-- inserire immagine -->
  In this representation:
  <ul>
    <li><a>ThermometerMock</a> represents the source of temperature-data;</li>
    <li><a>dataLogget.kt</a> is a Qak-actor that writes the data emitted by the thermometer on the file <a>themperatureLog.txt</a>.</li>
  <ul>
</div>
</div>


<h2>Testing</h2>


<h2>Deployment</h2>


<h2>Maintenance</h2>

<!-- USEFUL
<table style="width:100%" border="1">
<tr>
<td style="width:50%">
</td>
<td></td>
</tr>
</table>
-->

<br/><br/>
</div>

<div style="background-color:rgba(86, 56, 253, 0.9); width:60%;text-align:left;color:white">
By studentName email: giuseppe.cristaudo@studio.unibo.it, filippo.manfreda@studio.unibo.it, enrico.andrini@studio.unibo.it
<!--<img src="./img/emiglio.png" alt="mbot" width="15%" height="15%">-->
</div>
</body>
</html>
